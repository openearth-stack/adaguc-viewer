'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,e){a!=Array.prototype&&a!=Object.prototype&&(a[b]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,e,g){if(b){e=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var c=a[g];c in e||(e[c]={});e=e[c]}a=a[a.length-1];g=e[a];b=b(g);b!=g&&null!=b&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Math.log10",function(a){return a?a:function(a){return Math.log(a)/Math.LN10}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,e,g){var c=this.length||0;0>e&&(e=Math.max(0,c+e));if(null==g||g>c)g=c;g=Number(g);0>g&&(g=Math.max(0,c+g));for(e=Number(e||0);e<g;e++)this[e]=a;return this}},"es6-impl","es3");$jscomp.findInternal=function(a,b,e){a instanceof String&&(a=String(a));for(var g=a.length,c=0;c<g;c++){var f=a[c];if(b.call(e,f,c,a))return{i:c,v:f}}return{i:-1,v:void 0}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,g={next:function(){if(e<a.length){var c=e++;return{value:b(c,a[c]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a,e){return e})}},"es6","es3");$jscomp.checkStringArgs=function(a,b,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,e){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var c=b.length,f=a.length;e=Math.max(0,Math.min(e|0,b.length));for(var m=0;m<f&&e<c;)if(b[e++]!=a[m++])return!1;return m>=f}},"es6-impl","es3");$jscomp.owns=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,e){for(var b=1;b<arguments.length;b++){var c=arguments[b];if(c)for(var f in c)$jscomp.owns(c,f)&&(a[f]=c[f])}return a}},"es6-impl","es3");(function(a){a&&a.prototype&&null==a.prototype.children&&Object.defineProperty(a.prototype,"children",{get:function(){for(var a=0,e,g=this.childNodes,c=[];e=g[a++];)1===e.nodeType&&c.push(e);return c}})})(window.Node||window.Element);
"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(a,b){if(null==a)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(a),g=1;g<arguments.length;g++){var c=arguments[g];if(null!=c)for(var f in c)Object.prototype.hasOwnProperty.call(c,f)&&(e[f]=c[f])}return e},writable:!0,configurable:!0});Math.log10=Math.log10||function(a){return Math.log(a)*Math.LOG10E};
Array.prototype.filter||(Array.prototype.filter=function(a){if(void 0===this||null===this)throw new TypeError;var b=Object(this),e=b.length>>>0;if("function"!==typeof a)throw new TypeError;for(var g=[],c=2<=arguments.length?arguments[1]:void 0,f=0;f<e;f++)if(f in b){var m=b[f];a.call(c,m,f,b)&&g.push(m)}return g});function Console(a){function b(a){a=(a+"").replace(/&/g,"&amp;");a=a.replace(/</g,"&lt;");a=a.replace(/>/g,"&gt;");a=a.replace(/\"/g,"&quot;");return a=a.replace(/\n/g,"<br>")}var e=a,g="";this.println=function(a,f){g=0==f?g+("<p class='stdoutmessage'>"+a+"</p>"):g+("<p class='stdoutmessage'>"+b(a)+"</p>");isDefined(e)&&(e.innerHTML=g,e.scrollTop=e.scrollHeight);17824<g.length&&(g=g.substring(g.length-13368))};this.errprintln=function(a,f){g=0==f?g+("<p class='stderrmessage'>"+a+"</p>"):g+("<p class='stderrmessage'>"+
b(a)+"</p>");isDefined(e)&&(e.innerHTML=g,e.scrollTop=e.scrollHeight)};this.cls=function(){g="";isDefined(e)&&(e.innerHTML=g)};this.setSize=function(a,b){isDefined(e)&&(e.scrollTop=e.scrollHeight,e.style.width=a+"px",e.style.height=b+"px",e.width=a+"px",e.height=b+"px")};this.setElement=function(a){e=a;isDefined(e)&&(e.style.overflow="scroll",e.style.display="inline-block",e.style.position="absolute",e.style.width="100%",e.style.height="100%",e.style.font="normal 12px courier",e.noWrap=!0,e.style.whiteSpace=
"nowrap",e.innerHTML=g,e.scrollTop=e.scrollHeight)};this.setElement(a)}function isDefined(a){return"undefined"===typeof a?!1:!0}function isNull(a){return null===a?!0:!1}function toArray(a){if(!a)return[];if(a.length)return a;var b=[];b[0]=a;return b}var WMJSSet=function(){};WMJSSet.prototype.add=function(a){this[a]=!0};WMJSSet.prototype.remove=function(a){delete this[a]};
function WMJSKVP(a){var b=[];this._parse=function(a){var b=[];if(a=a.split("&"))for(var c in a){var e=a[c].split("=");if(2==e.length){var m=e[0],e=e[1];b[m]instanceof Array||(b[m]=[]);b[m].push(e)}}return b};this.getKeys=function(){var a=new WMJSSet;for(key in b)a.add(key);return a};this.getValues=function(a){return b[a]};this.getKeyValues=function(){return b};return b=this._parse(a)}
var preventdefault_event=function(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1},attach_event=function(a,b,e){if("mousewheel"==b){var g=function(a,b){var c=0;a||(a=window.event,window.event.cancelBubble=!0,window.event.returnValue=!1);a.wheelDelta?c=a.wheelDelta/120:a.detail&&(c=-a.detail/3);c&&b(c);a.preventDefault&&a.preventDefault();a.returnValue=!1};a.addEventListener&&a.addEventListener("DOMMouseScroll",function(a){g(a,e)},!1);a.onmousewheel=document.onmousewheel=
function(a){g(a,e)}}else browser.isNS?a.addEventListener(b,e,!0):(a.attachEvent("on"+b,e),void 0!=window.event&&(window.event.cancelBubble=!0,window.event.returnValue=!1))},del_event=function(a,b,e){var g=!0;browser.isOP&&(g=!1);a.removeEventListener?a.removeEventListener(b,e,g):a.detachEvent&&(a.detachEvent(b,e),a.detachEvent("on"+b,e))},getClick_X=function(a){return browser.isNS?a.clientX+window.scrollX:window.event.clientX+document.documentElement.scrollLeft+document.body.scrollLeft},getClick_Y=
function(a){return browser.isNS?a.clientY+window.scrollY:window.event.clientY+document.documentElement.scrollTop+document.body.scrollTop},findElementPos=function(a){for(var b=a,e=curtop=0;a;)e+=a.offsetLeft,curtop+=a.offsetTop,a=a.offsetParent;return[e,curtop,parseInt(b.style.width+e),parseInt(b.style.height+curtop)]};
function Browser(){this.isKonqueror=this.isOP=this.isNS=this.isIE=!1;this.name=navigator.appName;this.version=null;-1!=navigator.userAgent.indexOf("Opera")?this.isOP=!0:"Netscape"==navigator.appName||"Konqueror"==navigator.appName?this.isKonqueror=this.isNS=!0:-1!=navigator.appName.indexOf("Microsoft")&&(this.isIE=!0)}var browser=new Browser;function IsNumeric(a){var b=!0;for(i=0;i<a.length&&1==b;i++){var e=a.charAt(i);-1=="0123456789.".indexOf(e)&&(b=!1)}return b}
function dump(a,b,e){var g="";e||(e="");b||(b=0);if("object"===typeof a)for(var c in a){var f=a[c];if(IsNumeric(c)){c="["+c+"]";var m=e.substr(0,e.length-1)+c}else m=e+c;g="object"===typeof f?g+dump(f,b+1,m+"."):g+(m+'="'+f+'"<br>\n')}else g="===>"+a+"<===("+typeof a+")";return g}
var Url={encode:function(a){return escape(this._utf8_encode(a))},decode:function(a){alert("Deprecated function !!! WMJSTools line 325 with ["+a+"]");return this._utf8_decode(unescape(a))},_utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");for(var b="",e=0;e<a.length;e++){var g=a.charCodeAt(e);128>g?b+=String.fromCharCode(g):(127<g&&2048>g?b+=String.fromCharCode(g>>6|192):(b+=String.fromCharCode(g>>12|224),b+=String.fromCharCode(g>>6&63|128)),b+=String.fromCharCode(g&63|128))}return b},_utf8_decode:function(a){var b=
"",e=0;for(c1=c2=0;e<a.length;){var g=a.charCodeAt(e);128>g?(b+=String.fromCharCode(g),e++):191<g&&224>g?(c2=a.charCodeAt(e+1),b+=String.fromCharCode((g&31)<<6|c2&63),e+=2):(c2=a.charCodeAt(e+1),c3=a.charCodeAt(e+2),b+=String.fromCharCode((g&15)<<12|(c2&63)<<6|c3&63),e+=3)}return b}};Array.indexOf||(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]==a)return b;return-1});
function createXHR(){try{return new XMLHttpRequest}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(a){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(a){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(a){}return!1}
function MakeJSONRequest(a,b,e,g,c){function f(a){e?e(a,g):b(void 0,g)}function m(){0==c?(a=requestProxy+"REQUEST="+URLEncode(a),MakeJSONRequest(a,b,e,g,!0)):f("status("+l.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();c||(c=!1);try{var l=createXHR();l.open("GET",a,!0);l.onreadystatechange=function(){if(4==l.readyState)if(200==l.status){try{var c=eval("("+l.responseText+")")}catch(n){f("Invalid JSON: '"+l.responseText+"'");return}void 0==c?f("request returned no data:"+
a):b(c,g)}else m()};l.send(null)}catch(d){m()}}
function MakeHTTPRequest(a,b,e,g,c){function f(a){e?e(a,g):b(void 0,g)}function m(){0==c?(a=requestProxy+"REQUEST="+URLEncode(a),MakeHTTPRequest(a,b,e,g,!0)):f("status("+l.status+") to "+a)}a=-1==a.indexOf("?")?a+"?":a+"&";a+="rand="+Math.random();c||(c=!1);try{var l=createXHR();l.open("GET",a,!0);l.onreadystatechange=function(){if(4==l.readyState)if(200==l.status){try{var a=l.responseText}catch(n){f("Exception occured:"+n);return}void 0==a||""==a?f("request returned no data"):b(a,g)}else m()};l.send(null)}catch(d){m()}}
var URLDecode=function(a){if(!isDefined(a))return"";a=a.replaceAll("+"," ");a=a.replaceAll("%2B","+");a=a.replaceAll("%20"," ");a=a.replaceAll("%5E","^");a=a.replaceAll("%26","&");a=a.replaceAll("%3F","?");a=a.replaceAll("%3E",">");a=a.replaceAll("%3C","<");a=a.replaceAll("%5C","\\");a=a.replaceAll("%2F","/");a=a.replaceAll("%25","%");a=a.replaceAll("%3A",":");a=a.replaceAll("%27","'");return a=a.replaceAll("%24","$")},URLEncode=function(a){if(!a||void 0==a||""==a||"string"!==typeof a)return a;a=
a.replace(/\%/g,"%25");a=a.replace(/\+/g,"%2B");a=a.replace(/\ /g,"%20");a=a.replace(/\^/g,"%5E");a=a.replace(/\&/g,"%26");a=a.replace(/\?/g,"%3F");a=a.replace(/\>/g,"%3E");a=a.replace(/\</g,"%3C");a=a.replace(/\\/g,"%5C");for(var b="",e=0;e<a.length;e++){var g=a.charAt(e);if(" "==g)b+="%20";else if(-1!="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%-_.!~*'()".indexOf(g))b+=g;else{var c=g.charCodeAt(0);255<c?(alert("Unicode Character '"+g+"' cannot be encoded using standard URL encoding.\n(URL encoding only supports 8-bit characters.)\nA space (+) will be substituted."),
b+="+"):(b+="%",b+="0123456789ABCDEF".charAt(c>>4&15),b+="0123456789ABCDEF".charAt(c&15))}}return b};String.prototype.replaceAll=function(a,b){for(var e=this,g=e.indexOf(a);-1!=g;)e=e.replace(a,b),g=e.indexOf(a);return e};String.prototype.trim=function(){var a=this.replace(/^\s+/,"");return a=a.replace(/\s+$/,"")};function checkValidInputTokens(a){var b=/^([a-zA-Z'_:~%?\$,\.\0-9 \-=/&])+$/;return b.test(a)&&(a=URLDecode(a),b.test(a))?!0:!1}
function getUrlVars(){for(var a=[],b,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),g=0;g<e.length;g++)b=e[g].split("="),b[1]=URLDecode(b[1]),0!=checkValidInputTokens(b[0])&&0!=checkValidInputTokens(b[1])&&(a[b[0]]=b[1]+"");return a}
function getUrlVarsFromHashTag(){var a=[];var b=window.location.hash.indexOf("#");"?"==window.location.hash[b+1]&&b++;for(var e=window.location.hash.slice(b+1).split("&"),g=0;g<e.length;g++)b=e[g].split("="),b[1]=URLDecode(b[1]),0!=checkValidInputTokens(b[0])&&0!=checkValidInputTokens(b[1])&&(a[b[0]]=b[1]+"");return a}
var composeUrlObjectFromURL=function(a){var b=[];if(!isDefined(a))return b;var e="";a=a.split("?");1<a.length?(e=a[0],a=a[1].split("&")):a=a[0].split("&");for(var g=0;g<a.length;g++)hash=a[g].split("="),isDefined(hash[1])?(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(b[hash[0].toLowerCase()]=hash[1]+"")):(hash=a[g].split("%3D"),isDefined(hash[1])&&(hash[1]=URLDecode(hash[1]),0!=checkValidInputTokens(hash[0])&&
0!=checkValidInputTokens(hash[1])&&isDefined(hash[1])&&0<hash[1].length&&(b[hash[0].toLowerCase()]=hash[1]+"")));a[0].indexOf("=");return{location:e,kvp:b}},currentLocationHash="",hashTagCheckerInUse=!1,_checkIfHashTagChanged=function(a){var b=window.location.hash;currentLocationHash!=b&&0<b.length&&(currentLocationHash=b,-1!=window.location.href.indexOf("#")&&(b=window.location.href.split("#")[1],b=b.replaceAll("%27","'"),urlVars=getUrlVarsFromHashTag(),isDefined(urlVars.clearhash)&&"1"==urlVars.clearhash&&
(currentLocationHash=window.location.hash=""),a(b,urlVars)));setTimeout(function(){_checkIfHashTagChanged(a)},100)},checkIfHashTagChanged=function(a){isDefined(a)&&(1==hashTagCheckerInUse?alert("checkIfHashTagChanged is in use"):(hashTagCheckerInUse=!0,_checkIfHashTagChanged(a)))},decodeBase64=function(a){var b={},e,g=0,c,f=0,m,l="",d=String.fromCharCode,n=a.length;for(e=0;64>e;e++)b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)]=e;for(c=0;c<n;c++)for(e=b[a.charAt(c)],
g=(g<<6)+e,f+=6;8<=f;)((m=g>>>(f-=8)&255)||c<n-2)&&(l+=d(m));return l};function DateInterval(a,b,e,g,c,f){this.year=parseInt(a);this.month=parseInt(b);this.day=parseInt(e);this.hour=parseInt(g);this.minute=parseInt(c);this.second=parseInt(f);this.isRegularInterval=!1;0==this.month&&0==this.year&&(this.isRegularInterval=!0);this.getTime=function(){if(0!=this.month)throw"month != 0";if(0!=this.year)throw"year != 0";var a=0+86400*this.day;a+=3600*this.hour;a+=60*this.minute;a+=this.second;return 1E3*a};this.toISO8601=function(){var a="P";0!=this.year&&(a+=this.year+"Y");
0!=this.month&&(a+=this.month+"M");0!=this.day&&(a+=this.day+"D");0!=this.hour&&0!=this.minute&&0!=this.second&&(a+="T");0!=this.hour&&(a+=this.hour+"H");0!=this.minute&&(a+=this.minute+"M");0!=this.second&&(a+=this.second+"S");return a}}
function parseISO8601DateToDate(a){if(a){var b=a.split("T");b[0]=b[0].replace(/-/g,":");b[0]=b[0].replace(/::/g,":-");a=b[0].split(":");var b=b[1].split(":"),e=new Date(Date.UTC(a[0],a[1]-1,a[2],b[0],b[1],b[2].split("Z")[0]));e.add=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour),0!=a.minute&&
this.setUTCMinutes(this.getUTCMinutes()+a.minute),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second)):this.setTime(this.getTime()+a.getTime())};e.substract=function(a){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute),0!=a.second&&
this.setUTCSeconds(this.getUTCSeconds()-a.second)):this.setTime(this.getTime()-a.getTime())};e.addMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()+a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()+a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()+a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()+a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()+a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()+a.second*
b)):this.setTime(this.getTime()+a.getTime()*b)};e.substractMultipleTimes=function(a,b){0==a.isRegularInterval?(0!=a.year&&this.setUTCFullYear(this.getUTCFullYear()-a.year*b),0!=a.month&&this.setUTCMonth(this.getUTCMonth()-a.month*b),0!=a.day&&this.setUTCDate(this.getUTCDate()-a.day*b),0!=a.hour&&this.setUTCHours(this.getUTCHours()-a.hour*b),0!=a.minute&&this.setUTCMinutes(this.getUTCMinutes()-a.minute*b),0!=a.second&&this.setUTCSeconds(this.getUTCSeconds()-a.second*b)):this.setTime(this.getTime()-
a.getTime()*b)};e.toISO8601=function(){function a(a,b){a+="";b-=a.length;var c,e="";for(c=0;c<b;c++)e+="0"+e;return e+a}return a(this.getUTCFullYear(),4)+"-"+a(this.getUTCMonth()+1,2)+"-"+a(this.getUTCDate(),2)+"T"+a(this.getUTCHours(),2)+":"+a(this.getUTCMinutes(),2)+":"+a(this.getUTCSeconds(),2)+"Z"};e.clone=function(){return parseISO8601DateToDate(e.toISO8601())};return e}console.log("Warning: no date given to parseISO8601DateToDate")}
function parseISO8601IntervalToDateInterval(a){if("P"==a.charAt(0)){var b=a.split("T"),e=a=0,g=0,c=0;seconds=minutes=0;var f=b[0].split("P")[1];if(f){var m=f.indexOf("Y");var l=f.indexOf("M"),d=f.indexOf("D");-1!=m&&(a=f.substring(0,m));-1!=l&&(e=f.substring(m+1,l));-1!=d&&(-1!=l&&(m=l),g=f.substring(m+1,d))}0<b.length&&isDefined(b[1])&&(b=b[1])&&(m=b.indexOf("H"),f=b.indexOf("M"),l=b.indexOf("S"),-1!=m&&(c=b.substring(0,m)),-1!=f&&(minutes=b.substring(m+1,f)),-1!=l&&(-1!=f&&(m=f),seconds=b.substring(m+
1,l)));return new DateInterval(a,e,g,c,minutes,seconds)}}function getNumberOfTimeSteps(a,b,e){var g=0;if(0!=e.month||0!=e.year){a=a.clone();for(b=b.getTime();a.getTime()<b;)a.add(e),g++;g++}else g=parseInt((b.getTime()-a.getTime())/e.getTime()+.5)+1;return g}
function parseISOTimeRangeDuration(a){a=a.split("/");void 0==a[2]&&(a[2]="PT1M");void 0==a[1]&&(a[1]=a[0],a[2]="PT1M");this.startTime=parseISO8601DateToDate(a[0]);this.stopTime=parseISO8601DateToDate(a[1]);this.timeInterval=parseISO8601IntervalToDateInterval(a[2]);this.timeSteps=getNumberOfTimeSteps(this.startTime,this.stopTime,this.timeInterval);this.getTimeSteps=function(){return this.timeSteps};this.getDateAtTimeStep=function(a){if(0==this.timeInterval.isRegularInterval){var b=this.startTime.clone();
b.addMultipleTimes(this.timeInterval,a)}else{b=this.startTime.clone();var g=this.timeInterval.getTime(),g=g*a;b.setTime(b.getTime()+g)}return b};this.getTimeStepFromISODate=function(a,e){try{currentDate=parseISO8601DateToDate(a)}catch(g){throw"The date '"+a+"' is not a valid date";}return this.getTimeStepFromDate(currentDate,e)};this.getTimeStepFromDate=function(a,e){e||(e=!1);var b=a.getTime();if(b<this.startTime.getTime()){if(1==e)throw 0;return 0}var c=this.stopTime.clone();c.add(this.timeInterval);
if(b>c.getTime()){if(1==e)throw this.timeSteps-1;return this.timeSteps-1}if(b>this.stopTime.getTime())return this.timeSteps-1;if(0==this.timeInterval.isRegularInterval){e=this.startTime.clone();for(j=0;j<this.timeSteps;j++){c=e.getTime();e.add(this.timeInterval);var f=e.getTime();if(b>=c&&b<f)return j}throw"Date "+a.toISO8601()+" not found!";}a=(a.getTime()-this.startTime.getTime())/this.timeInterval.getTime();return a=parseInt(a);throw"Date "+a.toISO8601()+" not found";};this.getTimeStepFromDate_WithinRange=
function(a){return this.getTimeStepFromDate(a,!0)};this.getTimeStepFromDate_Clipped=function(a){return this.getTimeStepFromDate(a,!1)}}function getCurrentDateIso8601(){return parseISO8601DateToDate((new Date).toISOString().substring(0,19)+"Z")};Proj4js.defs["EPSG:3575"]="+proj=laea +lat_0=90 +lon_0=10 +x_0=0 +y_0=0 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";Proj4js.defs["EPSG:3785"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3857"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs";Proj4js.defs["EPSG:3411"]="+proj=stere +lat_0=90 +lat_ts=70 +lon_0=-45 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";
Proj4js.defs["EPSG:3412"]="+proj=stere +lat_0=-90 +lat_ts=-70 +lon_0=0 +k=1 +x_0=0 +y_0=0 +a=6378273 +b=6356889.449 +units=m +no_defs";Proj4js.defs["EPSG:4326"]="+proj=longlat +datum=WGS84 +no_defs";Proj4js.defs["EPSG:28992"]="+proj=sterea +lat_0=52.15616055555555 +lon_0=5.38763888888889 +k=0.9999079 +x_0=155000 +y_0=463000 +ellps=bessel +units=m +no_defs  <>";Proj4js.defs["EPSG:32661"]="+proj=stere +lat_0=90 +lat_ts=90 +lon_0=0 +k=0.994 +x_0=2000000 +y_0=2000000 +ellps=WGS84 +datum=WGS84 +units=m +no_defs";
Proj4js.defs["EPSG:102100"]=Proj4js.defs["EPSG:3857"];var epsgDescriptionLookup=[];epsgDescriptionLookup["EPSG:3411"]="NSIDC Sea Ice Polar Stereographic North";epsgDescriptionLookup["EPSG:3412"]="NSIDC Sea Ice Polar Stereographic South";epsgDescriptionLookup["EPSG:3575"]="Lambert azimuthal equal-area projection Europe";epsgDescriptionLookup["EPSG:3785"]="Mercator (deprecated)";epsgDescriptionLookup["EPSG:3857"]="Mercator";epsgDescriptionLookup["EPSG:4258"]="ETRS89";
epsgDescriptionLookup["EPSG:4326"]="World Lat lon WGS84";epsgDescriptionLookup["CRS:84"]="World Lat lon WGS84";epsgDescriptionLookup["EPSG:25831"]="ETRS89 / UTM zone 31N";epsgDescriptionLookup["EPSG:25832"]="ETRS89 / UTM zone 32N";epsgDescriptionLookup["EPSG:28992"]="Dutch Amersfoort / RD New";epsgDescriptionLookup["EPSG:32661"]="Polar Stereographic WGS 84 / UPS North";$.widget("ui.iconbutton",$.extend({},$.ui.button.prototype,{_init:function(){$.ui.button.prototype._init.call(this);this.element.removeClass("ui-corner-all").addClass("ui-iconbutton").unbind(".button")}}));var WMJSTileRenderer=function(a,b,e,g,c,f,m,l,d){if(d){"streetmap"===d&&(d="OSM");"pdok"===d&&(d="OSM");"naturalearth2"===d&&(d="NaturalEarth2");var n=l[d];if(n){var q=n[e];if(!q)for(var w in l)if(l.hasOwnProperty(w))for(var C in l[w])l[w].hasOwnProperty(C)&&C===e&&(q=l[w][C]);l=Math.PI;var v=256,z=12756274*l/v,r=-12756274*l/2,I=12756274*l/2;q.tileSize&&(v=q.tileSize);q.resolution&&(z=q.resolution);q.origX&&(r=q.origX);q.origY&&(I=q.origY);l=z*v+r;var D=I-z*v,R=l-r,k=I-D;(function(d){var l=q.home,
n=q.tileServerType;d<q.minLevel&&(d=q.minLevel);d>q.maxLevel&&(d=q.maxLevel);var w=Math.pow(2,d),C=R/(z/w*v),M=k/(z/w*v),w=parseInt(Math.round((a.left-r)/R*C/1+.5)),t=parseInt(Math.round((a.right-r)/R*C/1+.5)),A=parseInt(Math.round(M-(a.bottom-D)/k*M+.5)),W=parseInt(Math.round(M-(a.top-D)/k*M+.5)),da=function(a,b,c){a=z/Math.pow(2,a);return{x:b*a+r,y:I-c*a}},T=function(a,b,c,d){d=d*(a.y-b.top)/(b.bottom-b.top);return{x:parseFloat(c*(a.x-b.left)/(b.right-b.left)),y:parseFloat(d)}},O=function(a,d,e,
f){var k=da(d,e*v,f*v);var q=da(d,(e+1)*v,(f+1)*v);var r=k.x;var w=k.y;k=q.x;q=q.y;r=T({x:r,y:w},b,g,c);k=T({x:k,y:q},b,g,c);var z;"osm"===n&&(z=l+d+"/"+e+"/"+f+".png");if("arcgisonline"===n||"wmst"===n)z=l+d+"/"+f+"/"+e;d=m.getImage(z);!1===d.isLoaded()&&!1===d.hasError()&&!1===d.isLoading()&&d.load();if(d.isLoaded())try{a.drawImage(d.getElement()[0],parseInt(r.x),parseInt(r.y),parseInt(k.x-r.x)+1,parseInt(k.y-r.y)+1)}catch(aa){}};if("EPSG:4326"===e||"EPSG:4258"===e)C*=2;1>W&&(W=1);W>M&&(W=M);1>
w&&(w=1);w>C&&(w=C);1>A&&(A=1);A>M&&(A=M);1>t&&(t=1);t>C&&(t=C);if(!(10<A-W||10<t-w))for(C=W-1;C<A;C++)for(M=w-1;M<t;M++)O(f,d,M,C)})(parseInt(Math.log(Math.abs(l-r)/((a.right-a.left)/g*v))/Math.log(2)))}else console.error("Tiled layer with name "+d+" not found")}else console.error("layerName not defined")};var WMJSImageStore=function(a,b,e){this.imagesbysrc={};var g=this.imageLife=0,c=this,f=[],m=function(a,b){for(b=0;b<f.length;b++)f[b](a)};c.getImageForSrc=function(a){if(c.imagesbysrc[a])return c.imagesbysrc[a]};c.clear=function(){for(var a in c.imagesbysrc)c.imagesbysrc.hasOwnProperty(a)&&c.imagesbysrc[a].clear()};c.addLoadEventCallback=function(a){f.push(a)};c.getNumImagesLoading=function(){var a=0,b;for(b in c.imagesbysrc)c.imagesbysrc.hasOwnProperty(b)&&c.imagesbysrc[b].isLoading()&&a++;return a};
c.getImage=function(f){var d=c.getImageForSrc(f);if(void 0!==d)return d.imageLife=g++,d;d=c.imagesbysrc;if(Object.keys)var l=Object.keys(d);else{var q=[];for(l in d)Object.prototype.hasOwnProperty.call(d,l)&&q.push(l);l=q}if(l.length<a)d=new WMJSImage(f,m,b,e);else{l=-1;var d=g,w;for(w in c.imagesbysrc)c.imagesbysrc.hasOwnProperty(w)&&(q=c.imagesbysrc[w],!1===q.isLoading()&&!0===q.isLoaded()&&d>=q.imageLife&&(d=q.imageLife,l=w));console.log("Reusing image "+l+" with lifetime "+d);if(-1===l){console.error("not enough cache for "+
b);return}d=c.imagesbysrc[l];delete c.imagesbysrc[l];d.clear()}d.setSource(f);d.KVP=WMJSKVP(f);c.imagesbysrc[f]=d;d.imageLife=g++;return d}};var WebMapJSMapNo=0,WebMapJSMapVersion="3.0.4",logging=!1,base="./",noimage,showDialog=!0,loadingImageSrc,WMSControlsImageSrc,mapPinImageSrc,scaleBarURL,enableConsoleDebugging=!1,enableConsoleErrors=!1,debug=function(a){enableConsoleDebugging&&console.log(a)},error=function(a){enableConsoleErrors&&console.log("WebMapJS warning: ",a)},WMJScheckURL=function(a){if(!isDefined(a))return"?";a=a.trim();-1==a.indexOf("?")&&(a+="?");return a};
function WMJSProjection(){this.bbox=new WMJSBBOX;this.srs="EPSG:4326"}var legendImageStore,getMapImageStore,bgMapImageStore,maxAnimationSteps=1E3;legendImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjslegendbuffer");getMapImageStore=new WMJSImageStore(5*maxAnimationSteps,"wmjsimagebuffer");bgMapImageStore=new WMJSImageStore(5E3,"wmjsimagebuffer",{randomizer:!1});
var setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?");xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"},showDialogs=function(a){showDialog=a};
function WMJSMap(a,b){var e,g,c,f;function m(a){function p(pb){pb.currentTarget.removeEventListener("load",p,!1);d(a)}function b(p){(p=(p||event).srcElement)&&/^(complete|loaded)$/i.test(p.readyState)&&(p.detachEvent("onreadystatechange",b),d(a))}function d(a){1!=a.loadEventDone&&(a.loadEventDone=!0,a.loadEvent&&a.loadEvent(a))}a.style.left="0px";a.style.top="0px";a.loadEventDone=!1;a.failed=!1;a.addEventListener?a.addEventListener("load",p,!1):a.attachEvent("onreadystatechange",b);a.onerror=function(){a.src&&
a.src!=noimage&&(error(a.src),a.failed=!0,a.loadEvent&&a.loadEvent(a))}}function l(a){if(a){for(var p=0;p<r.length;p++)if(r[p]==a)return p;return-1}}function d(){n.mousedown(k.mouseDownEvent);n.mousewheel(k.mouseWheelEvent);attach_event(document,"mouseup",k.mouseUpEvent);attach_event(document,"mousemove",k.mouseMoveEvent);if(k.isTouchDevice()){k.enableInlineGetFeatureInfo(!1);var a=new Hammer.Manager(document.body);a.add(new Hammer.Pan);a.add(new Hammer.Pinch);a.get("pan").set({direction:Hammer.DIRECTION_ALL});
a.add(new Hammer.Swipe).recognizeWith(a.get("pan"));a.on("panstart",function(a){a.preventDefault();k.mouseDown(a.center.x,a.center.y,a)});a.on("panmove",function(a){a.preventDefault();k.mouseMove(a.center.x,a.center.y,a)});a.on("panend",function(a){a.preventDefault();k.mouseUp(a.center.x,a.center.y,a)});a.on("pinchstart",function(a){a.preventDefault();k.pinchStart(a.center.x,a.center.y,a)});a.on("pinchmove",function(a){a.preventDefault();k.pinchMove(a.center.x,a.center.y,a)});a.on("pinchend",function(a){a.preventDefault();
k.pinchEnd(a.center.x,a.center.y,a)})}k.setMapModePan()}this.setBaseURL=function(a){base=a;noimage=base+"/img/blank.gif?";loadingImageSrc=base+"/img/ajax-loader.gif";WMSControlsImageSrc=base+"/img/mapcontrols.gif";mapPinImageSrc=base+"/img/dot.gif";isDefined(scaleBarURL)||(scaleBarURL=base+"/php/makeScaleBar.php?")};this.showDialogs=function(a){showDialog=a};this.setBaseURL(base);this.setXML2JSONURL=function(a){xml2jsonrequest=a};this.setWMJSTileRendererTileSettings=function(a){tileRenderSettings=
a};try{isDefined(b)&&(xml2jsonrequestURL=b)}catch(p){xml2jsonrequestURL=base+"/php/xml2jsonrequest.php?"}try{isDefined(requestProxy)}catch(p){requestProxy=base+"/php/MakeRequest.php?"}try{isDefined(scaleBarURL)}catch(p){scaleBarURL=base+"/php/makeScaleBar.php?"}var n,q,w=new WMJSBBOX,C=new WMJSBBOX,v=2,z=2,r=[],I=[],D="",R=0,k=this;k.renderer="WMJSCanvasBuffer";var M=!1,J=document.createElement("div"),E=document.createElement("div"),u=document.createElement("div"),ca=document.createElement("div"),
ja=!0,t=new WMJSBBOX,A=new WMJSBBOX,W=new WMJSBBOX,da=new WMJSBBOX,T=new WMJSBBOX,O=[];k.getLegendStore=function(){return legendImageStore};var F=[],qa=!1,Za="default",Ca=!1,La="default",$a=!1,ab=!1,Ma=$('<div class="WMJSDivBuffer-loading"/>',{}),bb=0,aa=0,ea=1,Ea,ra=0,U=0,Na=0,Oa=0,X=Array(3),Pa=Array(3);for(j=0;3>j;j++)X[j]=new WMJSProjection,Pa[j]=new WMJSProjection;var cb=!0,B=new WMJSListener;this.getGraphingData=function(){return this.graphingData};this.setGraphingData=function(a){this.graphingData=
a};var Qa=function(p){a.id||(a.id="WebMapJSMapNo_"+WebMapJSMapNo,WebMapJSMapNo++);return a.id+"_"+p};this.enableInlineGetFeatureInfo=function(a){cb=a};this.closeAllGFIDialogs=function(){WMJSDialog.closeAllDialogs(S)};var S=[],db=function(){enableConsoleDebugging&&console.log("onlegendready called");fa()},sa=[],Fa=0,ta=!1,fa=function(a){if(!(2>O.length)){try{0==isDefined(a)&&(a=!1);if(1==ta&&isDefined(db)){1==B.addToCallback("onlegendready",db)&&enableConsoleDebugging&&console.log("Suspending on onlegendready");
return}ta=!0;if(1==ja){if(sa.length!=r.length)a=!0;else for(var p=0;p<r.length;p++){var b=k.getLegendGraphicURLForLayer(r[p]);isDefined(b)&&sa[p]!==b&&(sa[p]=b,a=!0)}if(a){sa=[];for(p=0;p<r.length;p++)!1!==r[p].enabled&&(b=k.getLegendGraphicURLForLayer(r[p]),isDefined(b)&&(sa[p]=b,O[Fa].setSrc(p,b)));var d=Fa;Fa=1-Fa;try{O[d].load(function(){enableConsoleDebugging&&console.log("Legend buffer nr"+d);try{for(var a=0,p=0;p<O[d].layers.length;p++){O[d].layers[p].getElement();var b=O[d].layers[p].getElement()[0].height;
a<b&&(a=b)}O[d].display();O[1-d].hide()}catch(qb){console.error(qb)}ta=!1;B.triggerEvent("onlegendready")})}catch(ka){console.error(ka),O[0].hide(),O[1].hide(),ta=!1,B.triggerEvent("onlegendready")}return}}else O[0].hide(),O[1].hide()}catch(ka){console.log(ka)}ta=!1;B.triggerEvent("onlegendready")}},Ra="",Sa="";this.setMessage=function(a){Sa=a&&""!==a?a:""};this.setTimeOffset=function(a){Ra=a&&""!==a?a:""};this.canvasErrors=[];this.getCapabilitiesJSON=function(a,b){WMJSGetCapabilities(a,!0,b,function(a){error(a);
b(a)})};this.rebuildMapDimensions=function(){for(var a=0;a<I.length;a++)I[a].used=!1;for(i=0;i<r.length;i++)for(a=0;a<r[i].dimensions.length;a++){var b=r[i].dimensions[a],d=k.getDimension(b.name);isDefined(d)?d.used=!0:(b=b.clone(),b.used=!0,I.push(b))}for(a=0;a<I.length;a++)0==I[a].used&&(I.splice(a,1),a--);B.triggerEvent("onmapdimupdate")};this.getLayerByServiceAndName=function(a,b){for(var p=0;p<r.length;p++){var d=r[r.length-p-1];if(d.name==b&&d.service==a)return d}};this.getLayers=function(){for(var a=
[],b=0;b<r.length;b++)a.push(r[r.length-b-1]);return a};this.setLayer=function(a,b){return k.addLayer(a,b,a)};this.setActive=function(a){$a=a;ab=!0};this.setActiveLayer=function(a){Ea=a;fa();B.triggerEvent("onchangeactivelayer")};this.calculateNumBaseLayers=function(){R=0;if(D)for(var a=0;a<D.length;a++)D[a].enabled&&0==D[a].keepOnTop&&R++};this.enableLayer=function(a){a.enabled=!0;k.calculateNumBaseLayers();k.rebuildMapDimensions();fa(!0)};this.disableLayer=function(a){a.enabled=!1;k.calculateNumBaseLayers();
k.rebuildMapDimensions();fa(!0)};this.toggleLayer=function(a){a.enabled=1==a.enabled?!1:!0;k.calculateNumBaseLayers();k.rebuildMapDimensions();fa(!0)};this.displayLayer=function(a,b){a.enabled=b;k.calculateNumBaseLayers();k.rebuildMapDimensions();fa(!0)};this.removeAllLayers=function(){for(var a=0;a<r.length;++a)r[a].setAutoUpdate(!1);r=[];I=[];B.triggerEvent("onlayeradd")};this.deleteLayer=function(a){if(!(0>=r.length)){a.setAutoUpdate(!1);a=l(a);if(0<=a){for(var p=a;p<r.length-1;p++)r[p]=r[p+1];
r.length--;Ea=void 0;0<=a&&a<r.length?(k.rebuildMapDimensions(),k.setActiveLayer(r[a])):0<r.length&&(k.rebuildMapDimensions(),k.setActiveLayer(r[r.length-1]))}B.triggerEvent("onlayerchange");k.rebuildMapDimensions()}};this.moveLayerDown=function(a){var p=l(a);if(0<p){a=r[p-1];var b=r[p];a&&b&&(r[p]=a,r[p-1]=b)}else try{error("moveLayerDown: layer '"+a.name+"' not found.")}catch(Da){error("moveLayerDown: layer invalid.")}};this.moveLayerUp=function(a){var p=l(a);if(p<r.length-1){a=r[p+1];var b=r[p];
a&&b&&(r[p]=a,r[p+1]=b)}else try{error("moveLayerUp: layer '"+a.name+"' not found.")}catch(Da){error("moveLayerUp: layer invalid.")}};this.addLayer=function(a){isDefined(a)&&(a.parentMaps.push(k),r.push(a),a.parseLayer(function(a){for(var p=0;p<a.dimensions.length;p++){var b=k.getDimension(a.dimensions[p].name);isDefined(b)&&isDefined(b.currentValue)&&1==a.dimensions[p].linked&&a.dimensions[p].setClosestValue(b.currentValue)}k.rebuildMapDimensions();B.triggerEvent("onlayeradd")},void 0,"WMJSLayer::addLayer"))};
this.getActiveLayer=function(){return Ea};this.setProjection=function(a,b){k.hideMapPin();a||(a="EPSG:4326");"object"===typeof a&&(b=a.bbox,a=a.srs);q=a;k.proj4.srs==q&&isDefined(this.proj4.projection)||(k.proj4.projection=new Proj4js.Proj(q),k.proj4.srs=q);k.setBBOX(b);C.setBBOX(b);k.updateMouseCursorCoordinates();B.triggerEvent("onsetprojection",[q,t])};this.getBBOX=function(){return A};this.getProjection=function(a){return{srs:q,bbox:t}};this.getSize=function(){return{width:v,height:z}};this.getWidth=
function(){return v};this.getHeight=function(){return z};this.repositionLegendGraphic=function(a){ja?fa(a):(O[0].hide(),O[1].hide())};this.resizeHeight=this.resizeWidth=-1;var Ta=!1,rb=new WMJSTimer;this.setSize=function(a,b){enableConsoleDebugging&&console.log("setSize",a,b);4>parseInt(a)||4>parseInt(b)?console.log("Skipping setSize",a,b):(this.resizeWidth=parseInt(a),this.resizeHeight=parseInt(b),!1===Ta?(Ta=!0,k._setSize(k.resizeWidth,k.resizeHeight)):rb.init(200,function(){Ta=!1;k._setSize(k.resizeWidth,
k.resizeHeight);k.draw("resizeTimer")}))};this._setSize=function(p,b){if(p&&b&&!(4>parseInt(p)||4>parseInt(b))){enableConsoleDebugging&&console.log("setSize("+p+","+b+")");var d=this.getProjection();v=parseInt(p);z=parseInt(b);if(4>v||isNaN(v))v=4;if(4>z||isNaN(z))z=4;d.srs&&d.bbox||(error("this.setSize: Setting default projection (EPSG:4326 with (-180,-90,180,90)"),d.srs="EPSG:4326",d.bbox.left=-180,d.bbox.bottom=-90,d.bbox.right=180,d.bbox.top=90,k.setProjection(d.srs,d.bbox));n.css({width:v,height:z});
a.style.width=v+"px";a.style.height=z+"px";k.setBBOX(w);k.repositionMapPin();k.showBoundingBox();1<F.length&&(F[0].resize(k.getWidth(),k.getHeight()),F[1].resize(k.getWidth(),k.getHeight()));1<O.length&&(O[0].resize(k.getWidth(),k.getHeight()),O[1].resize(k.getWidth(),k.getHeight()));k.repositionLegendGraphic(!0);F[ea]&&F[ea].display();B.triggerEvent("onresize",[v,z])}};this.getBBOXandProjString=function(a){var b="";if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)b+="SRS="+URLEncode(q)+
"&",b+="BBOX="+t.left+","+t.bottom+","+t.right+","+t.top+"&";a.version==WMSVersion.version130&&(b+="CRS="+URLEncode(q)+"&",b="EPSG:4326"==q&&0==a.wms130bboxcompatibilitymode?b+("BBOX="+t.bottom+","+t.left+","+t.top+","+t.right+"&"):b+("BBOX="+t.left+","+t.bottom+","+t.right+","+t.top+"&"));return b};this.isTouchDevice=function(){return"undefined"!==typeof window.ontouchstart};this.getDimensionRequestString=function(a){return ua(a)};this.dateToISO8601=function(a){function b(a,b){a+="";b-=a.length;
var p,d="";for(p=0;p<b;p++)d+="0"+d;return d+a}return b(a.getUTCFullYear(),4)+"-"+b(a.getUTCMonth()+1,2)+"-"+b(a.getUTCDate(),2)+"T"+b(a.getUTCHours(),2)+":"+b(a.getUTCMinutes(),2)+":"+b(a.getUTCSeconds(),2)+"Z"};this.buildWMSGetMapRequest=function(a){if(isDefined(a.name)&&(a.format||(a.format="image/png",error("layer format missing!")),!(1>a.name.length))){if("GFI:TIME_ELEVATION"==q){var b=a.getmapURL;b+="&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version;b+="&LAYERS="+URLEncode(a.name);var p=
a.name.split(",");b+="&QUERY_LAYERS="+URLEncode(p[p.length-1]);b=b+"&BBOX=29109.947643979103,6500000,1190890.052356021,7200000"+("&CRS="+URLEncode("EPSG:3857")+"&");b+="WIDTH="+v;b+="&HEIGHT="+z;if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)b+="&X=707&Y=557";a.version==WMSVersion.version130&&(b+="&I=707&J=557");b+="&FORMAT=image/gif&INFO_FORMAT=image/png&STYLES=";a=k.dateToISO8601(new Date(t.left));p=k.dateToISO8601(new Date(t.right));return b=b+("&time="+a+"/"+p)+("&elevation="+
t.bottom+"/"+t.top)}b=a.getmapURL;b+="&SERVICE=WMS&";b+="VERSION="+a.version+"&";b+="REQUEST=GetMap&";b+="LAYERS="+URLEncode(a.name)+"&";b+="WIDTH="+v+"&";b+="HEIGHT="+z+"&";b+=k.getBBOXandProjString(a);b+="STYLES="+URLEncode(a.currentStyle)+"&";b+="FORMAT="+a.format+"&";b=!0===a.transparent?b+"TRANSPARENT=TRUE&":b+"TRANSPARENT=FALSE&";try{b+=ua(a)}catch(Da){return}return b+=a.wmsextensions.url}};this.abort=function(){B.triggerEvent("onmapready");M=!1;B.triggerEvent("onloadingcomplete")};this.isBusy=
function(){return M||0==F[0].ready||0==F[1].ready?!0:!1};this.getLegendGraphicURLForLayer=function(a){if(a){var b=a.legendGraphic;if(b){b+="&layers="+URLEncode(a.name)+"&";try{1==a.legendIsDimensionDependant&&(b+=k.getDimensionRequestString(a)+"&")}catch(la){return}return b=b+"&transparent=true&width=90&height=250&"+a.wmsextensions.url}}};var Ua=!0;this.showScaleBar=function(){Ua=!0;console.log("todo showScaleBar")};this.hideScaleBar=function(){Ua=!1;console.log("todo hideScaleBar")};this.getMaxNumberOfAnimations=
function(){return maxAnimationSteps};this.drawLastTimes=function(a,b){b||(b="hours");if(0!==r.length){var p=this.getActiveLayer();if(p&&(p=p.getDimension("time"))){var d=p.size()-1,c=[],e=moment.utc(p.getValueForIndex(d));for(a=e.subtract(a,b);0<=d;){e=p.getValueForIndex(d--);if(!e||e===WMJSDateTooEarlyString||a.isAfter(moment.utc(e)))break;c.unshift({name:"time",value:e})}this.draw(c)}}};this.drawAutomatic=function(a,b){if(0!==r.length){a=a.format("YYYY-MM-DDTHH:mm:ss");for(var p=[],d=0;moment(a)<
b&&1E3>d;){d++;for(var c=null,e=r.length-1;0<=e;e--){var f=r[e].getDimension("time");f&&(f=f.getNextClosestValue(a))&&"date too early"!==f&&(null===c||moment(f)<moment(c))&&(c=f)}if(null===c)break;p.push({name:"time",value:c});a=c}if(0<p.length)p.pop(),this.draw(p);else if(b=r[0].getDimension("time")){a=b.size();d=Math.min(b.size(),100);p=[];for(d=a-d;d<a;++d)p.push({name:b.name,value:b.getValueForIndex(d)});this.draw(p)}}};new WMJSDebouncer;this.display=function(){F[ea].display(A,W);enableConsoleDebugging&&
console.log("drawnBBOX.setBBOX(bbox)");T.setBBOX(t)};this.draw=function(a){k.isAnimating?enableConsoleDebugging&&console.log("ANIMATING: Skipping draw:"+a):k._draw(a)};this._draw=function(a){enableConsoleDebugging&&console.log("draw:"+a);enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");T.setBBOX(t);a:if(!(4>v||4>z)){B.triggerEvent("beforedraw");if(!1===k.isAnimating&&void 0!==a&&"object"===typeof a&&0<a.length){if(a.length>maxAnimationSteps){alert("Too many animations given, max is "+
maxAnimationSteps);k.draw("self");break a}k.isAnimating=!0;B.triggerEvent("onstartanimation",k);k.currentAnimationStep=0;k.animationList=[];k.mouseHoverAnimationBox=!1;for(var b=0;b<a.length;b++){var p={name:a[b].name,value:a[b].value};k.setDimension(a[b].name,a[b].value,!1);p.requests=k.getWMSRequests();k.animationList.push(p)}k.setDimension(k.animationList[k.currentAnimationStep].name,k.animationList[k.currentAnimationStep].value,!1);eb.checkAnimation()}4>v||4>z?console.log("map too small, skipping"):
k._pdraw()}};var sb=function(){debug("--\x3e onmapready event called");k.draw("onmapready callback")};this.getWMSRequests=function(){var a=[],b=k.getNumLayers();for(j=0;j<b;j++)if(r[j].service&&r[j].enabled){var d=k.buildWMSGetMapRequest(r[j]);d&&a.push(d)}return a};this.prefetch=function(a){var b=[];for(j=0;j<a.length;j++){var p=getMapImageStore.getImage(a[j]);0==p.isLoaded()&&0==p.isLoading()&&(b.push(p),p.load())}return b};this.getImageStore=function(){return getMapImageStore};this.isThisRequestLoaded=
function(a){a=getMapImageStore.getImageForSrc(a);if(void 0==a)return 0;if(a.isLoaded())return 2;if(a.isLoading())return 1};this.mouseHoverAnimationBox=!1;this._pdraw=function(){if(0!=bb)if(M)1==B.addToCallback("onmapready",sb)&&debug("Suspending on onmapready");else{enableConsoleDebugging&&console.log("loadLayers");var a,b=0;R=0;if(D)for(var d=0;d<D.length;d++)D[d].enabled&&!1===D[d].keepOnTop&&(!D[d].type||"twms"!==D[d].type)&&(R++,a=k.buildWMSGetMapRequest(D[d]))&&(F[aa].setSrc(b,a,k.getWidth(),
k.getHeight(),{layer:D[d]}),F[aa].setOpacity(b,D[d].opacity),b++);for(d=0;d<k.getNumLayers();d++)r[d].service&&r[d].enabled&&(a=k.buildWMSGetMapRequest(r[d],r[d].dimensions))&&(F[aa].setSrc(b,a,k.getWidth(),k.getHeight(),{layer:r[d]}),F[aa].setOpacity(b,r[d].opacity),r[d].image=F[aa].layers[b],b++);if(D)for(d=0;d<D.length;d++)D[d].enabled&&1==D[d].keepOnTop&&(a=k.buildWMSGetMapRequest(D[d]))&&(F[aa].setSrc(b,a,k.getWidth(),k.getHeight(),{layer:D[d]}),F[aa].setOpacity(b,D[d].opacity),b++);k.flipBuffers();
B.triggerEvent("ondrawready",k);fa()}};var eb,ma=function(a){if(0!=F.length){var b=t;isDefined(a)&&(b=a);A.copy(b);F[ea].setBBOX(A,W);F[ea].mapbbox=A;k.showBoundingBox(E.bbox,A);B.triggerEvent("onupdatebbox",A);k.repositionMapPin(a)}},fb=new WMJSTimer;k.flipBuffers=function(){enableConsoleDebugging&&console.log("flipBuffers");var a=ea,b=aa;B.triggerEvent("onmapstartloading");M=!0;fb.init(500,function(){Ma.show()});da.setBBOX(t);F[b]&&F[b].load(function(){enableConsoleDebugging&&console.log("flipBuffers loadcomplete");
try{F[a].srs=q,F[b].bbox=t.clone(),F[b].srs=q,enableConsoleDebugging&&console.log("loadedBBOX.setBBOX(bbox)"),W.setBBOX(da),enableConsoleDebugging&&console.log("-----------------------"),F[b].display(A,W),u.oldx=u.exactX,u.oldy=u.exactY,F[a].hide(),ea=b,aa=a}catch(la){console.log(la)}M=!1;B.triggerEvent("onmaploadingcomplete",k);B.triggerEvent("onloadingcomplete",k);B.triggerEvent("onmapready",k);Ma.hide();fb.stop()})};k.getBackBufferCanvasContext=function(){return F[aa].getCanvasContext()};k.getFrontBufferCanvasContext=
function(){return F[ea].getCanvasContext()};k.redrawBuffer=function(){F[ea].display();enableConsoleDebugging&&console.log("drawnBBOX.setBBOX(bbox)");T.setBBOX(t)};this.addBaseLayers=function(a){if(a){R=0;a=toArray(a);D.push(a);for(j=0;j<D.length;j++)1==D.keepOnTop&&R++;B.triggerEvent("onlayeradd")}else D=void 0};this.setBaseLayers=function(a){if(a){R=0;D=a;for(j=0;j<D.length;j++)1==D.keepOnTop&&R++;B.triggerEvent("onlayerchange")}else D=void 0};this.getBaseLayers=function(){return D};this.getNumLayers=
function(){return r.length};this.getBaseElement=function(){return n};var va=0,wa,gb=new WMJSDebouncer,na=0,xa=new WMJSBBOX,ga=new WMJSBBOX,ya=new WMJSBBOX,hb=new WMJSBBOX,ha=0,oa=0,jb=function(){na=wa/1;var a=1-na;ga.left=xa.left*a+ya.left*na;ga.bottom=xa.bottom*a+ya.bottom*na;ga.right=xa.right*a+ya.right*na;ga.top=xa.top*a+ya.top*na;ma(ga);wa+=1;1<wa?(wa=1,k.setBBOX(ga),k.display(),0===oa?(ha=oa=0,k.draw("flyZoomToBBOXTimerFunc")):(ha=oa=0,ib(A,hb))):gb.init(10,jb)},ib=function(a,b){1===ha?(hb.copy(b),
oa=1):(xa.copy(a),ya.copy(b),wa=1,oa=0,0===ha&&(ha=1,jb()))},kb=new WMJSBBOX,za=new WMJSBBOX;this.mouseWheelEvent=function(a,b,d,c){a.stopPropagation();preventdefault_event(a);if(1!=va){va=1;var p=A.right-A.left,e=A.bottom-A.top;a=k.getGeoCoordFromPixelCoord({x:G,y:H},T);c=(a.x-A.left)/p;d=(a.y-A.top)/e;if(0>b){p*=-.15;var f=-.15*e}else p*=.1,f=.1*e;b=A.left+p;e=A.top+f;p=A.right-p;f=A.bottom-f;c=c*(p-b)+b-a.x;a=d*(f-e)+e-a.y;b-=c;p-=c;e-=a;f-=a;kb.copy(A);za.left=b;za.bottom=f;za.right=p;za.top=
e;va=0;ib(kb,za)}};var N;this.pinchStart=function(a,b,d){c=d.pointers[0].clientX;f=d.pointers[0].clientY;e=d.pointers[1].clientX;g=d.pointers[1].clientY;N=t.clone();V=0;va=ba=1};this.pinchMove=function(a,b,d){V=0;pinchMove1={x:d.pointers[0].clientX,y:d.pointers[0].clientY};pinchMove2={x:d.pointers[1].clientX,y:d.pointers[1].clientY};a=pinchMove2.x-pinchMove1.x;b=e-c;d=pinchMove2.y-pinchMove1.y;var p=g-f;0==b&&(b=1);0==p&&(p=1);a*a>d*d?(a/=b,b=c-pinchMove1.x/a,t.right=((v-pinchMove1.x)/a+c)/v*(N.right-
N.left)+N.left,t.left=b/v*(N.right-N.left)+N.left,a=(N.right-N.left)/(N.top-N.bottom),b=(t.top+t.bottom)/2,a=(t.left-t.right)/2/a,t.bottom=b+a,t.top=b-a):(a=d/p,b=f-pinchMove1.y/a,t.bottom=((z-pinchMove1.y)/a+f)/z*(N.bottom-N.top)+N.top,t.top=b/z*(N.bottom-N.top)+N.top,a=(N.right-N.left)/(N.top-N.bottom),b=(t.right+t.left)/2,a*=(t.bottom-t.top)/2,t.left=b+a,t.right=b-a);ma(t)};this.pinchEnd=function(a,b,d){va=ba=V=0;k.zoomTo(t);k.draw("pinchEnd")};k.destroy=function(){k.stopAnimating();for(var a=
r.length-1;0<=a;a--)r[a].setAutoUpdate(!1);console.log("Detaching...");n.off("mousedown");n.off("mousewheel");del_event(document,"mouseup",k.mouseUpEvent);del_event(document,"mousemove",k.mouseMoveEvent)};var lb=function(a){return"TIME"==a.toUpperCase()||"ELEVATION"==a.toUpperCase()?a:"DIM_"+a},ua=function(a){for(var b="",d=0;d<a.dimensions.length;d++){var c=a.dimensions[d].getValue(),b=b+("&"+lb(a.dimensions[d].name)),b=b+("="+URLEncode(c));if(c==WMJSDateOutSideRange||c==WMJSDateTooEarlyString||
c==WMJSDateTooLateString)throw WMJSDateOutSideRange;}return b},G=0,H=0,K=-1E4,L=-1E4,Y=1E4,Z=1E4,ba=0,V=0,P="pan";this.getMapMode=function(){return P};this.getWMSMetaDataRequestURL=function(a){var b=a.service,b=b+("&SERVICE=WMS&REQUEST=GetMetaData&VERSION="+a.version),b=b+("&LAYER="+URLEncode(a.name)),b=b+"&FORMAT=text/html";try{b+="&"+ua(a)}catch(la){return}debug("<a target='_blank' href='"+b+"'>"+b+"</a>",!1);return b};var ia=0,Va=[],Wa=function(a,b){this.layer=a;this.data=b},tb=function(a,b,d,
c,e){c=c+("&GRAPHSTYLE="+e)+("&"+k.getBBOXandProjString(a));c+="&LAYERS="+URLEncode(a.name);c+="WIDTH="+v;c+="&HEIGHT="+z;c+="&X="+b;c+="&Y="+d;c+="&FORMAT=image/png";c+="&INFO_FORMAT=text/html";c+="&STYLES=";try{c+="&"+ua(a)}catch(Ga){return}debug("<a target='_blank' href='"+c+"'>"+c+"</a>",!1);return c};this.getWMSGetFeatureInfoRequestURL=function(a,b,d){var c=WMJScheckURL(a.service),c=c+("&SERVICE=WMS&REQUEST=GetFeatureInfo&VERSION="+a.version),c=c+("&LAYERS="+URLEncode(a.name)),p=a.name.split(","),
c=c+("&QUERY_LAYERS="+URLEncode(p[p.length-1])),c=c+("&"+k.getBBOXandProjString(a)),c=c+("WIDTH="+v),c=c+("&HEIGHT="+z);if(a.version==WMSVersion.version100||a.version==WMSVersion.version111)c=c+("&X="+b)+("&Y="+d);a.version==WMSVersion.version130&&(c=c+("&I="+b)+("&J="+d));c+="&FORMAT=image/gif&INFO_FORMAT=text/html&STYLES=";try{c+="&"+ua(a)}catch(Ga){return}debug("<a target='_blank' href='"+c+"'>"+c+"</a>",!1);return c};var Ha=function(a,b){ia--;a=b?1==b.queryable?new Wa(b,a):new Wa(b,"not queryable"):
new Wa(b,"Query failed...");Va.push(a);0>=ia&&(ia=0,B.triggerEvent("ongetfeatureinfoready",Va))},ub=function(){debug("resuming on ongetpointinfoready");k.getPointInfo(K,L)},Ia=!1;this.getPointInfo=function(a,b){if(Ia)debug("suspending on ongetpointinfoready"),k.addListener("ongetpointinfoready",ub,!1);else{Ia=!0;B.triggerEvent("beforegetpointinfo");var d=k.getGraphingData();if(void 0==d)error("getPointInfo getGraphingData is undefined"),Ia=!1;else{debug("getPointInfo("+a+","+b+") "+d.layer.name);
var c=tb(d.layer,a,b,d.service,d.style);debug("GetPointInfo: "+c);var p=new Image;p.loadEvent=function(){Ia=!1;var a={};a.url=c;a.layer=d.layer;a.img=p;B.triggerEvent("ongetpointinfoready",a)};m(p);p.src=c}}};var vb=function(){debug("resuming on ongetfeatureinfoready");B.triggerEvent("beforegetfeatureinfo");k.getFeatureInfo(K,L)};this.getFeatureInfo=function(a,b){if(0<ia)debug("suspending on ongetfeatureinfoready"),k.addListener("ongetfeatureinfoready",vb,!1);else{debug("GetFeatureInfo:");Va=[];for(var d=
ia=0;d<r.length;d++){var c=r[r.length-d-1];c.getFeatureInfoUrl="";c.service&&c.enabled&&1==c.queryable&&(c.getFeatureInfoUrl=k.getWMSGetFeatureInfoRequestURL(c,a,b),isDefined(c.getFeatureInfoUrl)?ia++:c.getFeatureInfoUrl="")}0==ia&&B.triggerEvent("ongetfeatureinfoready",["No layers to query"]);for(d=0;d<r.length;d++)if(a=r[r.length-d-1],""!=a.getFeatureInfoUrl)if(0==a.queryable)Ha("Layer is not queryable.",a);else try{MakeHTTPRequest(a.getFeatureInfoUrl,Ha,function(a,b){Ha(a,b);error(a)},a)}catch(ka){Ha("Exception: "+
ka,a)}}};this.getGetFeatureInfoObjectAsHTML=function(a){var b="";try{for(var b=b+'<div class="getfeatureinfo">',d=0;d<r.length;d++)for(var c=0;c<a.length;c++)a[c].layer==r[d]&&(b+='<div class="getfeatureinfolayer">',b+="<b><a target='_blank' href='"+a[c].layer.getFeatureInfoUrl+"'>"+a[c].layer.title+"</a></b><br/>",b+=a[c].data,b+="</div>");b+="</div>"}catch(ka){b="No layers to query."}return b};this.getMapPinXY=function(){return[u.exactX,u.exactY]};this.positionMapPinByLatLon=function(a){debug("positionMapPinByLatLon at "+
a.x+","+a.y);a=k.getPixelCoordFromLatLong(a);k.setMapPin(a.x,a.y);k.showMapPin()};this.repositionMapPin=function(a){var b=t;isDefined(a)&&(b=a);a=k.getPixelCoordFromGeoCoord({x:u.geoPosX,y:u.geoPosY},b);k.setMapPin(a.x,a.y,b)};this.setMapPin=function(a,b,d){var c=a;"object"===typeof a&&(c=a.x,b=a.y);c&&b&&(u.x=parseInt(c),u.y=parseInt(b),u.exactX=parseFloat(c),u.exactY=parseFloat(b),a=k.getGeoCoordFromPixelCoord({x:u.exactX,y:u.exactY},d),u.geoPosX=a.x,u.geoPosY=a.y,u.style.left=u.x-5+"px",u.style.top=
u.y-7+"px")};this.isMapPinVisible=function(){return"none"==u.style.display?!1:!0};this.showMapPin=function(){u.innerHTML="<img src='"+mapPinImageSrc+"'>";u.style.display=""};this.hideMapPin=function(){u.style.display="none"};this.setMapModeGetInfo=function(){P="info";n.css("cursor","default")};this.setMapModeZoomBoxIn=function(a){P="zoom";n.css("cursor","default")};this.setMapModeZoomOut=function(a){P="zoomout";n.css("cursor","default")};this.setMapModePan=function(a){P="pan";n.css("cursor","default")};
this.setMapModePoint=function(a,b){P="point";n.css("cursor","url(webmapjs/img/aero_pen.cur), default")};var Aa;this.setMapModeNone=function(a){P="none";n.css("cursor","default")};this.getMouseCoordinatesForDocument=function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var d=$(a).parent().offset(),c=b.pageX,e=b.pageY;void 0==c&&(c=getClick_X(b));void 0==e&&(e=getClick_Y(b));return{x:c-d.left,y:e-d.top}};this.getMouseCoordinatesForElement=
function(b){if(isDefined(b.changedTouches))return{x:parseInt(b.changedTouches[0].screenX),y:parseInt(b.changedTouches[0].screenY)};var d=$(a).parent().offset(),c=b.pageX,e=b.pageY;void 0==c&&(c=getClick_X(b));void 0==e&&(e=getClick_Y(b));return{x:c-d.left,y:e-d.top}};this.mouseDown=function(a,b,d){var c=!1;d&&1==d.shiftKey&&(c=!0);K=a;L=b;V=1;if(0===ba&&0===(0>L|0>K|K>v|L>z?-1:0))for(a=B.triggerEvent("beforemousedown",{mouseX:a,mouseY:b,mouseDown:!0,event:d}),b=0;b<a.length;b++)if(!1===a[b])return;
c?(void 0==Aa&&(Aa=P),P="zoom"):void 0!=Aa&&(P=Aa,Aa=void 0);B.triggerEvent("mousedown",{map:k,x:K,y:L});"info"==P?(debug("GetFeatureInfo"),k.setMapPin(K,L),k.showMapPin(),B.triggerEvent("beforegetfeatureinfo",{map:k,x:K,y:L}),k.getFeatureInfo(K,L)):"point"==P&&(k.setMapPin(K,L),k.showMapPin(),k.getPointInfo(K,L))};var mb=!1,Q=!1,Ja,Xa;this.updateMouseCursorCoordinates=function(a){Xa=a;Ja=k.getGeoCoordFromPixelCoord(a);k.display("updateMouseCursorCoordinates")};this.mouseDownEvent=function(a){preventdefault_event(a);
var b=k.getMouseCoordinatesForDocument(a);qa&&0>b.y||k.mouseDown(b.x,b.y,a)};this.mouseMoveEvent=function(a){preventdefault_event(a);var b=k.getMouseCoordinatesForDocument(a);0===V&&0<=b.y&&0>b.y&&0<=b.x&&b.x<=v?!1===qa&&(qa=!0,Za=La,Ca=!0,k.setCursor("pointer"),k.draw("mouseMoveEvent")):!0===qa&&(Ca=qa=!1,k.setCursor(Za),k.draw("mouseMoveEvent"));k.mouseMove(b.x,b.y,a)};this.mouseUpEvent=function(a){preventdefault_event(a);var b=k.getMouseCoordinatesForDocument(a);k.mouseUp(b.x,b.y,a)};this.mouseMove=
function(b,d){G=b;H=d;if(0===ba)for(b=B.triggerEvent("beforemousemove",{mouseX:G,mouseY:H,mouseDown:1===V?!0:!1}),d=0;d<b.length;d++)if(!1===b[d])return;if(1==E.displayed&&0==pa){b=k.getPixelCoordFromGeoCoord({x:E.bbox.left,y:E.bbox.top});d=k.getPixelCoordFromGeoCoord({x:E.bbox.right,y:E.bbox.bottom});var c=!1;0==V&&(!1===Q&&(mb=n.css("cursor")),6>Math.abs(G-b.x)&&H>b.y&&H<d.y&&(c=!0,n.css("cursor","col-resize"),Q="left"),6>Math.abs(H-b.y)&&G>b.x&&G<d.x&&(c=!0,n.css("cursor","row-resize"),Q="top"),
6>Math.abs(G-d.x)&&H>b.y&&H<d.y&&(c=!0,n.css("cursor","col-resize"),Q="right"),6>Math.abs(H-d.y)&&G>b.x&&G<d.x&&(c=!0,n.css("cursor","row-resize"),Q="bottom"),6>Math.abs(G-b.x)&&6>Math.abs(H-b.y)&&(c=!0,n.css("cursor","nw-resize"),Q="topleft"),6>Math.abs(G-d.x)&&6>Math.abs(H-b.y)&&(c=!0,n.css("cursor","ne-resize"),Q="topright"),6>Math.abs(G-b.x)&&6>Math.abs(H-d.y)&&(c=!0,n.css("cursor","sw-resize"),Q="bottomleft"),6>Math.abs(G-d.x)&&6>Math.abs(H-d.y)&&(c=!0,n.css("cursor","se-resize"),Q="bottomright"));
if(1==c||!1!==Q&&1==V){1==V&&("left"==Q&&(b.x=G),"top"==Q&&(b.y=H),"right"==Q&&(d.x=G),"bottom"==Q&&(d.y=H),"topleft"==Q&&(b.x=G,b.y=H),"topright"==Q&&(d.x=G,b.y=H),"bottomleft"==Q&&(b.x=G,d.y=H),"bottomright"==Q&&(d.x=G,d.y=H),b=k.getGeoCoordFromPixelCoord(b),d=k.getGeoCoordFromPixelCoord(d),E.bbox.left=b.x,E.bbox.top=b.y,E.bbox.right=d.x,E.bbox.bottom=d.y,k.showBoundingBox(E.bbox),B.triggerEvent("bboxchanged",{map:k,bbox:E.bbox}));return}Q=!1;n.css("cursor",mb)}if(-1==(0>H|0>G|G>v|H>z?-1:0)){try{B.triggerEvent("onmousemove",
[void 0,void 0]),k.updateMouseCursorCoordinates(void 0)}catch(Ga){console.log(Ga)}Y=G;Z=H;0!=pa&&(1==V&&"zoomout"==P&&k.zoomOut(),V=0,1==ba&&nb(Y,Z))}else{if(1==V&&!(3>Math.abs(K-G)&&3>Math.abs(L-H))){d=G;b=H;if(0==ba){if("pan"==P){ha&&k.setBBOX(ga);ha=oa=0;gb.stop();n.css("cursor","move");var c=parseInt(d),e=parseInt(b);u.oldx=u.exactX;u.oldy=u.exactY;for(var f=0;f<S.length;f++)S[f].origX=S[f].x,S[f].origY=S[f].y;pa=1;enableConsoleDebugging&&console.log("updateBBOX.setBBOX(drawnBBOX)");A.setBBOX(T);
Ba=k.getGeoCoordFromPixelCoord({x:c,y:e},t)}"zoom"==P&&(n.css("cursor","crosshair"),Ka=1);ba=1}"pan"==P&&0!=pa&&(d=parseInt(d),b=parseInt(b),0>G||0>H||G>parseInt(a.clientWidth)||H>parseInt(a.clientHeight)?ob(d,b):(d=k.getGeoCoordFromPixelCoord({x:d,y:b},A),b=d.x-Ba.x,d=d.y-Ba.y,A.left-=b,A.bottom-=d,A.right-=b,A.top-=d,ma(A)));"zoom"==P&&0!=Ka&&(d=G-K,b=H-L,0>d&&0>b?n.css("cursor","not-allowed"):n.css("cursor","crosshair"),h=b,J.style.display="",0>d?(d=-d,J.style.left=G+"px"):J.style.left=K+"px",
0>h?(h=-h,J.style.top=H+"px"):J.style.top=L+"px",J.style.width=d+"px",J.style.height=h+"px")}B.triggerEvent("onmousemove",[G,H]);k.updateMouseCursorCoordinates({x:G,y:H})}};this.mouseUp=function(a,b,d){Y=a;Z=b;if(0===ba&&0===(0>Z|0>Y|Y>v|Z>z?-1:0))for(a=B.triggerEvent("beforemouseup",{mouseX:a,mouseY:b,mouseDown:!1,event:d}),b=0;b<a.length;b++)if(!1===a[b]){V=0;return}if(1==V){"zoomout"==P&&k.zoomOut();if(0==ba&&3>Math.abs(K-Y)&&3>Math.abs(L-Z))if(isDefined(d)&&B.triggerEvent("mouseclicked",{map:k,
x:Y,y:Z,shiftKeyPressed:1==d.shiftKey}),1==cb){if(0==S.length){var c=WMJSDialog.createDialog({show:showDialog,x:Y,y:Z,autoDestroy:!1},n,k);S.push(c)}else c=S[0];0==c.hasBeenDragged&&(1==c.moveToMouseCursor?c.setXY(Y,Z):c.setXY(5,45));c.on("hide",function(a,b){c.hasBeenDragged=!1});c.setLoading();c.show();k.addListener("ongetfeatureinfoready",function(a){c.setHTML(k.getGetFeatureInfoObjectAsHTML(a))},!0);k.setMapPin(K,L);k.showMapPin();B.triggerEvent("beforegetfeatureinfo");k.getFeatureInfo(K,L)}else k.setMapPin(K,
L),k.showMapPin();B.triggerEvent("mouseup",{map:k,x:Y,y:Z})}V=0;1==ba&&nb(Y,Z)};var nb=function(a,b){if(0!=ba){ba=0;"pan"==P&&ob(a,b);if("zoom"==P){b=Y-K;var d=Z-L;n.css("cursor","default");0!=Ka&&(Ka=0,J.style.display="none",0>b&&0>d||(a=new WMJSBBOX,0>b?(a.left=K+b,a.right=K):(a.left=K,a.right=K+b),0>d?(a.top=L+d,a.bottom=L):(a.top=L,a.bottom=L+d),b=k.pixelCoordinatesToXY({x:a.left,y:a.bottom}),d=k.pixelCoordinatesToXY({x:a.right,y:a.top}),a.left=b.x,a.bottom=b.y,a.right=d.x,a.top=d.y,k.zoomTo(a),
k.draw("mapZoomEnd")))}B.triggerEvent("mapdragend",{map:k,x:Y,y:Z})}},pa=0,Ba,ob=function(a,b){n.css("cursor","default");a=parseInt(a);b=parseInt(b);0!=pa&&(pa=0,a=k.getGeoCoordFromPixelCoord({x:a,y:b},T),b=a.x-Ba.x,a=a.y-Ba.y,A.left=T.left-b,A.bottom=T.bottom-a,A.right=T.right-b,A.top=T.top-a,ma(A),k.zoomTo(A),k.draw("mapPanEnd"))},Ka=0;this.setCursor=function(a){La=a?a:"default";n.css("cursor",La)};this.zoomTo=function(a){enableConsoleDebugging&&console.log("zoomTo");var b=!1;a=new WMJSBBOX(a);
try{var d=(w.left-w.right)/(w.bottom-w.top)}catch(Da){b=!0}isNaN(d)&&(b=!0);1==b&&(error("Invalid bbox: setting ratio to 1"),d=1);0>d&&(d=-d);d>v/z?(b=(a.top+a.bottom)/2,d=(a.left-a.right)/2/d,a.bottom=b+d,a.top=b-d):(b=(a.right+a.left)/2,d*=(a.bottom-a.top)/2,a.left=b+d,a.right=b-d);k.setBBOX(a);ma(t);T.setBBOX(t);k.getPixelCoordFromGeoCoord({x:u.geoPosX,y:u.geoPosY});for(a=0;a<S.length;a++)k.getPixelCoordFromGeoCoord({x:S[a].geoPosX,y:S[a].geoPosY}),0==S[a].hasBeenDragged&&1==S[a].moveToMouseCursor&&
S[a].setXY(S[a].origX+x,S[a].origY+y)};this.pixelCoordinatesToXY=function(a){return k.getGeoCoordFromPixelCoord(a)};this.getGeoCoordFromPixelCoord=function(a,b){var d=t;b&&(d=b);if(isDefined(a)){try{var c=a.x/v*(d.right-d.left)+d.left;var e=a.y/z*(d.bottom-d.top)+d.top}catch(Ga){return}return{x:c,y:e}}};this.proj4={};this.proj4.srs="empty";this.proj4.projection=void 0;var Ya=new Proj4js.Proj("EPSG:4326");this.getProj4=function(){k.proj4.srs==q&&isDefined(this.proj4.projection)||(k.proj4.projection=
new Proj4js.Proj(q),k.proj4.srs=q);return{lonlat:Ya,proj4:k.proj4.projection,Proj4js:Proj4js}};this.getPixelCoordFromLatLong=function(a){var b=new Proj4js.Point;try{b.x=parseFloat(a.x),b.y=parseFloat(a.y),k.proj4.srs==q&&isDefined(this.proj4.projection)||(k.proj4.projection=new Proj4js.Proj(q),k.proj4.srs=q),Proj4js.transform(Ya,k.proj4.projection,b)}catch(la){alert(debug("error in getPixelCoordFromLatLong "+la));return}return k.getPixelCoordFromGeoCoord(b)};this.WCJSSearchRequest=function(a){console.log(a);
a.trim().match(/^(-?(?:[1-8]?\d(?:\.\d+)?|90(?:\.0+)?),-?(?:180(?:\.0+)?|(?:(?:1[0-7]\d)|(?:[1-9]?\d))(?:\.\d+)?))$/)?(splitted=a.split(","),lat=splitted[0],lng=splitted[1],k.calculateBoundingBoxAndZoom(lat,lng)):"undefined"===typeof geoNamesURL&&"undefined"===typeof knmiGeoNamesURL?error(I18n.no_urls_in_config.text):a.trim()?(searchDef=a.trim().match(/^[a-zA-Z0-9 ]*$/))?"undefined"!==typeof knmiGeoNamesURL?(a=knmiGeoNamesURL.replace("{searchTerm}",searchDef),debug(I18n.debug_searching_location.text),
debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1),$.ajax({dataType:"jsonp",contentType:"application/jsonp",jsonpCallback:"resultGeo",crossDomain:!0,type:"GET",url:a,success:function(a){if(0===$(a).length){var b=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch);console.log("urlApiGeonames",b);k.WCJSSearchRequestGeoNames(b)}else b=parseFloat($(a)[0].lat),a=parseFloat($(a)[0].lon),k.calculateBoundingBoxAndZoom(b,a)},error:function(a,b,d){error(I18n.geonames_api_call_failed.text)}})):
(a=geoNamesURL.replace("{searchTerm}",searchDef).replace("{username}",defaultUsernameSearch),console.log("urlApiGeonames",a),k.WCJSSearchRequestGeoNames(a)):(debug(I18n.only_alpha_num_allowed.text),$("#searchtextfield").attr("value","")):(debug(I18n.no_search_definition.text),$("#searchtextfield").attr("value",""))};this.WCJSSearchRequestGeoNames=function(a){debug(I18n.debug_searching_sqlite_location.text);debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);$.ajax({dataType:"xml",type:"GET",url:a,
success:function(a){if("0"===$(a).find("totalResultsCount").text())error(I18n.no_results_search.text);else{var b=parseFloat($(a).find("geoname").find("lat").text());a=parseFloat($(a).find("geoname").find("lng").text());k.calculateBoundingBoxAndZoom(b,a)}},error:function(a,b,d){error(I18n.geonames_sqlite_call_failed.text)}})};this.calculateBoundingBoxAndZoom=function(a,b){var d=5E5;if("EPSG:4326"===k.proj4.projection.srsCode||"EPSG:50001"===k.proj4.projection.srsCode)d=5;var c=k.getPixelCoordFromLatLong({x:b,
y:a}),c=k.getGeoCoordFromPixelCoord(c),e=new WMJSBBOX;e.left=c.x-d;e.bottom=c.y-d;e.right=c.x+d;e.top=c.y+d;k.zoomTo(e);k.positionMapPinByLatLon({x:b,y:a});k.draw("zoomIn")};this.getLatLongFromPixelCoord=function(a){var b=new Proj4js.Point;try{b.x=a.x/v*(t.right-t.left)+t.left,b.y=a.y/z*(t.bottom-t.top)+t.top,this.proj4.srs!=q&&(this.proj4.projection=new Proj4js.Proj(q),this.proj4.srs=q),Proj4js.transform(this.proj4.projection,Ya,b)}catch(la){return}return{x:b.x,y:b.y}};this.getPixelCoordFromGeoCoord=
function(a,b,d,c){var e=v,f=z,g=A;isDefined(d)&&(e=d);isDefined(c)&&(f=c);isDefined(b)&&(g=b);b=f*(a.y-g.top)/(g.bottom-g.top);return{x:parseFloat(e*(a.x-g.left)/(g.right-g.left)),y:parseFloat(b)}};this.addListener=function(a,b,d){return B.addToCallback(a,b,d)};this.removeListener=function(a,b){return B.removeEvents(a,b)};this.getListener=function(a){return B};this.suspendEvent=function(a){B.suspendEvent(a)};this.resumeEvent=function(a){B.resumeEvent(a)};this.getDimensionList=function(){return I};
this.getDimension=function(a){for(var b=0;b<I.length;b++)if(I[b].name==a)return I[b]};this.setDimension=function(a,b,d){debug("WebMapJS::setDimension('"+a+"','"+b+"')");if(isDefined(a)&&isDefined(b)){var c=k.getDimension(a);0==isDefined(c)&&(c={name:a,currentValue:b},I.push(c));isDefined(void 0)&&(void 0).setValue(a,b);if(c.currentValue!=b){c.currentValue=b;if(1==k.buildLayerDimsBusy)alert("b");else for(b=0;b<I.length;b++)for(var c=I[b],e=0;e<r.length;e++)for(var f=0;f<r[e].dimensions.length;f++){var g=
r[e].dimensions[f];if(1==g.linked&&g.name==c.name){if("current"==c.currentValue||"default"==c.currentValue||""==c.currentValue||"earliest"==c.currentValue||"middle"==c.currentValue||"latest"==c.currentValue)c.currentValue=g.getClosestValue(c.currentValue);k.buildLayerDimsBusy=!0;g.setClosestValue(c.currentValue);k.buildLayerDimsBusy=!1}}!1!==d&&(d=!0);!0===d&&B.triggerEvent("ondimchange",a)}}else error("Unable to set dimension with undefined value or name")};this.setLayerOpacity=function(a,b){if(a){a.opacity=
b;var d=R;for(j=0;j<k.getNumLayers();j++)if(r[j].service&&r[j].enabled){if(a==r[j]){k.setBufferImageOpacity(aa,d,b);break}d++}}};this.zoomToLayer=function(a){var b=a;b||(b=Ea);if(b){for(var d=0;d<b.projectionProperties.length;d++)if(b.projectionProperties[d].srs==q){a=b.projectionProperties[d].bbox.right-b.projectionProperties[d].bbox.left;var c=b.projectionProperties[d].bbox.top-b.projectionProperties[d].bbox.bottom,b=b.projectionProperties[d].bbox.clone();b.left-=a/100;b.right+=a/100;b.bottom-=
c/100;b.top+=c/100;k.zoomTo(b);k.draw("zoomTolayer");return}error("Unable to find the correct bbox with current map projection "+q+" for layer "+b.title+". Using default bbox instead.")}k.zoomTo(C);k.draw("zoomTolayer")};this.setPreviousExtent=function(){Na=1;U++;U>=ra&&(U=ra-1);k.setProjection(X[U].srs,X[U].bbox);k.draw("setPreviousExtent")};this.setNextExtent=function(){Oa=1;U--;0>U&&(U=0);k.setProjection(X[U].srs,X[U].bbox);k.draw("setNextExtent")};this.setBBOX=function(a,b,d,c){enableConsoleDebugging&&
console.log("setBBOX");t.setBBOX(a,b,d,c);w.setBBOX(t);if("GFI:TIME_ELEVATION"!==q){var e=v/z;if((t.right-t.left)/(t.top-t.bottom)>e){var f=(t.top+t.bottom)/2,e=(t.left-t.right)/2/e;t.bottom=f+e;t.top=f-e}else f=(t.right+t.left)/2,e*=(t.bottom-t.top)/2,t.left=f+e,t.right=f-e}A.setBBOX(t);T.setBBOX(t);if(0==Oa&&0==Na){if(0!=U){for(j=0;j<=U;j++)Pa[j]=X[j];for(j=0;j<=U;j++)X[j]=Pa[U-j];U=0}for(j=2;0<j;j--)X[j].bbox.setBBOX(X[j-1].bbox),X[j].srs=X[j-1].srs;X[0].bbox.setBBOX(t);X[0].srs=q;ra++;3<ra&&(ra=
3)}Na=Oa=0;if(!0===t.equals(a,b,d,c))return!1;B.triggerEvent("aftersetbbox",k);return!0};this.zoomOut=function(){var a=(w.right-w.left)/6;this.zoomTo(new WMJSBBOX(w.left-a,w.bottom-a,w.right+a,w.top+a));k.draw("zoomOut")};this.zoomIn=function(a){var b=(w.left-w.right)/8;if(0==isDefined(a))a=1;else if(0==a)return;b*=a;this.zoomTo(new WMJSBBOX(w.left-b,w.bottom-b,w.right+b,w.top+b));k.draw("zoomIn")};this.searchForLocation=function(a){k.WCJSSearchRequest(a)};this.displayLegendInMap=function(a){ja=a;
k.repositionLegendGraphic()};this.showBoundingBox=function(a,b){isDefined(a)&&(E.bbox=a,E.style.display="",E.displayed=!0);!0===E.displayed&&(a=t,isDefined(b)&&(a=b),b=this.getPixelCoordFromGeoCoord({x:E.bbox.left,y:E.bbox.top},a),a=this.getPixelCoordFromGeoCoord({x:E.bbox.right,y:E.bbox.bottom},a),E.style.left=b.x-1+"px",E.style.top=b.y-2+"px",E.style.width=a.x-b.x+"px",E.style.height=a.y-b.y-1+"px")};this.hideBoundingBox=function(){E.style.display="none";E.displayed=!1};this.setDebugFunction=function(a){debug=
a};this.setErrorFunction=function(a){error=a};(function(){try{tileRenderSettings=WMJSTileRendererTileSettings}catch(Da){}a.style.height||(a.style.height="1px");a.style.width||(a.style.width="1px");var b=Qa("baseDiv");jQuery("<div/>",{id:b,css:{position:"relative",overflow:"hidden",width:a.clientWidth,height:a.clientHeight,border:"0px  solid black",margin:0,padding:0,clear:"both",left:"0px",top:"0px"}}).appendTo(a);n=$("#"+b);n.css("cursor","default");a.style.margin="0px";a.style.padding="0px";a.style.border=
"none";a.style.lineHeight="0px";a.style.display="inline-block";J.style.position="absolute";J.style.display="none";J.style.border="2px dashed #000000";J.style.margin="0px";J.style.padding="0px";J.style.lineHeight="0";J.style.background="#AFFFFF";J.style.opacity="0.3";J.style.filter="alpha(opacity=30)";J.style.left="0px";J.style.top="0px";J.style.width="100px";J.style.height="100px";J.style.zIndex=1E3;J.oncontextmenu=function(){return!1};n.append(J);E.style.position="absolute";E.style.display="none";
E.style.border="3px solid #6060FF";E.style.margin="0px";E.style.padding="0px";E.style.lineHeight="0";E.style.left="0px";E.style.top="0px";E.style.width="100px";E.style.height="100px";E.style.zIndex=1E3;E.oncontextmenu=function(){return!1};n.append(E);u.style.position="absolute";u.style.display="none";u.style.border="none";u.style.margin="0px";u.style.padding="0px";u.style.lineHeight="0";u.style.background="none";u.style.opacity="1.0";u.style.filter="alpha(opacity=100)";u.style.left="0px";u.style.top=
"0px";u.style.width="100px";u.style.height="100px";u.style.zIndex=1E3;u.oncontextmenu=function(){return!1};u.innerHTML="<img src='"+mapPinImageSrc+"'>";u.style.display="";n.append(u);ca.style.position="absolute";ca.style.zIndex=1E3;ca.style.width="auto";ca.style.height="auto";ca.style.background="none";ca.oncontextmenu=function(){return!1};ca.innerHTML="";n.append(ca);n.append(Ma);"undefined"!==typeof defaultUsernameSearch&&(jQuery("<div/>",{id:Qa("searchboxdiv"),mousedown:function(a){a.stopPropagation()}}).addClass("webmapjs_searchboxdiv").html("<input class='webmapjs_locationfield' type='text' name='searchtextfield' id='searchtextfield' placeholder="+
I18n.place_search_term.text+" />",{mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(n),jQuery("<button/>",{id:Qa("searchboxbutton"),mousedown:function(a){a.stopPropagation()},click:function(){var a=$("#searchtextfield").val();k.searchForLocation(a)}}).addClass("webmapjs_locationbutton").appendTo(n),$("#searchtextfield").keypress(function(a){if(13==a.which)return a=$("#searchtextfield").val(),k.searchForLocation(a),!1}));d();t.left=-180;t.bottom=-90;t.right=180;t.top=90;
q="EPSG:4326";k.setSize(a.clientWidth,a.clientHeight);for(b=0;2>b;b++){var c=new WMJSCanvasBuffer(B,"imagebuffer",getMapImageStore,k.getWidth(),k.getHeight());getMapImageStore.addLoadEventCallback(c.imageLoadComplete);n.append(c.getBuffer());F.push(c)}for(b=0;2>b;b++)c=new WMJSCanvasBuffer(B,"legendbuffer",legendImageStore,k.getWidth(),k.getHeight()),legendImageStore.addLoadEventCallback(c.imageLoadComplete),n.append(c.getBuffer()),O.push(c);B.addToCallback("display",k.display,!0);B.addToCallback("draw",
function(){console.log("draw event triggered externally, skipping")},!0);eb=new WMJSAnimate(k);bgMapImageStore.addLoadEventCallback(function(a){k.draw("bgMapImageStore loaded")});k.addListener("beforecanvasstartdraw",function(a){if(D)for(var b=0;b<D.length;b++)!D[b].enabled||!1!==D[b].keepOnTop||D[b].type&&"twms"!==D[b].type||WMJSTileRenderer(t,A,q,v,z,a,bgMapImageStore,tileRenderSettings,D[b].name)},!0);var e=function(a,b,d,c,e){a.textBaseline="top";a.fillStyle="#FFF";a.globalAlpha=.75;var f=a.measureText(b).width;
a.fillRect(d-8,c-8,f+16,parseInt(e)+14);a.fillStyle="#444";a.globalAlpha=1;a.fillText(b,d,c+2)};k.addListener("beforecanvasdisplay",function(a){ab&&(a.beginPath(),a.rect(0,0,v,0),!1===$a?(a.globalAlpha=Ca?.9:.4,a.fillStyle=Ca?"#017daf":"#EEE"):(a.globalAlpha=1,a.fillStyle="#017daf"),a.fill(),a.globalAlpha=1);for(i=0;i<r.length;i++)for(var b="",d=0;d<r[i].dimensions.length;d++)b+="&"+lb(r[i].dimensions[d].name),b+="="+URLEncode(r[i].dimensions[d].currentValue),r[i].dimensions[d].currentValue==WMJSDateOutSideRange?
k.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time outside range"}}):r[i].dimensions[d].currentValue==WMJSDateTooEarlyString?k.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time too early"}}):r[i].dimensions[d].currentValue==WMJSDateTooLateString&&k.canvasErrors.push({linkedInfo:{layer:r[i],message:"Time too late"}});if(k.canvasErrors&&0<k.canvasErrors.length){var d=v/2,c=6+15*k.canvasErrors.length,b=v-d;a.beginPath();a.rect(b,0,b+d,0+c);a.fillStyle="white";a.globalAlpha=.9;a.fill();a.globalAlpha=
1;a.fillStyle="black";a.font="10pt Helvetica";for(d=0;d<k.canvasErrors.length;d++)k.canvasErrors[d].linkedInfo?a.fillText("Layer with title "+k.canvasErrors[d].linkedInfo.layer.title+" failed to load"+(k.canvasErrors[d].linkedInfo.message?", "+k.canvasErrors[d].linkedInfo.message:""),b+5,11+15*d):a.fillText("Layer failed to load.",b+5,11+15*d);k.canvasErrors=[]}""!==Ra&&(a.font="20px Helvetica",e(a,Ra,v/2-70,z-26,20));""!==Sa&&(a.font="15px Helvetica",e(a,Sa,v/2-70,2,15));if(!0===Ua&&(b=function(){var a=
1E-7,b=v/(A.right-A.left);if(!(0>=b)){var d=25/b;do{a*=10;var c=d/a;if(0===c)return;c=25/c}while(25>c);do{a/=2;c=d/a;if(0===c)return;c=25/c}while(25<c);do{a*=1.2;c=d/a;if(0===c)return;c=25/c}while(25>c);d=Math.pow(10,Math.round(Math.log10(a)+.5)-1);a=Math.round(a/d);2.5>a&&(a=2.5);2.5<a&&7.5>a&&(a=5);7.5<a&&(a=10);a*=d;return{width:parseInt(25/(25/b/a)),mapunits:a}}}())){d=z-25.5;a.beginPath();a.lineWidth=2.5;a.fillStyle="#000";a.strokeStyle="#000";a.font="9px Helvetica";a.textBaseline="middle";for(c=
0;2>c;c++)a.moveTo(7.5,21-c+d),a.lineTo(2*b.width+8.5,21-c+d);c=parseInt(Math.round(b.width/5));a.lineWidth=.5;for(var f=1;5>f;f++)a.moveTo(7.5+c*f,21+d),a.lineTo(7.5+c*f,16+d);a.lineWidth=1;a.moveTo(7.5,21+d);a.lineTo(7.5,14+d);a.moveTo(7.5+b.width,21+d);a.lineTo(7.5+b.width,14+d);a.moveTo(2*b.width+8.5,21+d);a.lineTo(2*b.width+8.5,14+d);c="";"EPSG:3411"===q&&(c="meter");"EPSG:3412"===q&&(c="meter");"EPSG:3575"===q&&(c="meter");"EPSG:4326"===q&&(c="degrees");"EPSG:28992"===q&&(c="meter");"EPSG:32661"===
q&&(c="meter");"EPSG:3857"===q&&(c="meter");"EPSG:900913"===q&&(c="meter");"EPSG:102100"===q&&(c="meter");"meter"===c&&1E3<b.mapunits&&(b.mapunits/=1E3,c="km");a.fillText("0",4.5,12+d);f=b.mapunits.toPrecision()+"";a.fillText(f,7.5+b.width-2.5*f.length+0,12+d);f=(2*b.mapunits).toPrecision()+"";a.fillText(f,7.5+2*b.width-2.5*f.length+0,12+d);a.fillText(c,2*b.width+17.5,18+d);a.stroke()}a.font="10px Helvetica";a.textBaseline="middle";isDefined(Ja)&&(d=1/Math.pow(10,parseInt(Math.log((t.right-t.left)/
v)/Math.log(10))-2),1>d&&(d=1),a.fillStyle="#000000",b=Math.round(Ja.x*d)/d,d=Math.round(Ja.y*d)/d,c="","EPSG:3857"===q&&(c="meter"),a.fillText("CoordYX: ("+d+", "+b+") "+c,5,z-50));isDefined(Xa)&&(b=k.getLatLongFromPixelCoord(Xa),isDefined(b)&&(a.fillStyle="#000000",d=Math.round(100*b.x)/100,a.fillText("Lat/Lon: ("+(Math.round(100*b.y)/100).toFixed(2)+", "+d.toFixed(2)+")  degrees",5,z-38)));a.fillStyle="#000000";a.fillText("Map projection: "+q,5,z-26);a.font="7px Helvetica";a.fillText("ADAGUC webmapjs "+
WebMapJSMapVersion,v-85,z-5)},!0);k.addListener("canvasonerror",function(a){k.canvasErrors=a},!0);bb=1})();ma(t)};WMJSEmptyLayerName="empty_layer";WMJSEmptyLayerTitle="empty layer";
function WMJSLayer(a){this.autoupdate=!1;this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.WMJSService=this.service=this.timer=void 0;this.keepOnTop=!1;this.transparent=!0;this.hasError=!1;this.legendIsDimensionDependant=!0;this.wms130bboxcompatibilitymode=!1;this.version=WMSVersion.version111;this.path="";this.type="wms";this.objectpath=[];this.wmsextensions=function(a){this.wmsextensions.colorscalerange="";isDefined(a.colorscalerange)&&(this.wmsextensions.colorscalerange=a.colorscalerange);
this.wmsextensions.url="";2<this.wmsextensions.colorscalerange.length&&(this.wmsextensions.url+="&COLORSCALERANGE="+this.wmsextensions.colorscalerange)};this.wmsextensions.url="";this.name=this.jsonlayer_v1_1_1=void 0;this.title=WMJSEmptyLayerTitle;this.abstract=void 0;this.dimensions=[];this.legendGraphic="";this.projectionProperties=[];this.queryable=!1;this.enabled=!0;this.styles=void 0;this.currentStyle="";this.id=-1;this.opacity=1;this.getCapabilitiesDoc=this.image=void 0;this.serviceTitle="not defined";
this.onReady=function(a){};this.parentMaps=[];this.getLayerName=function(){return this.name};this.toggleAutoUpdate=function(){(this.autoupdate=!this.autoupdate)?this.timer=setInterval(function(a){return function(){a.parseLayer(void 0,!0,"WMJSLayer::autoupdate")}}(this),6E4):clearInterval(this.timer)};this.setAutoUpdate=function(a,e,g){a!==this.autoupdate&&((this.autoupdate=a)?this.timer=setInterval(function(a){return function(){a.parseLayer(g,!0,"WMJSLayer::autoupdate")}}(this),e):clearInterval(this.timer))};
this.setOpacity=function(a){this.opacity=a;this.image&&(this.image.setOpacity(this.opacity),this.parentMaps[0].redrawBuffer())};this.remove=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].deleteLayer(this),this.parentMaps[a].draw("WMJSLayer::remove");clearInterval(this.timer)};this.moveUp=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerUp(this),this.parentMaps[a].draw("WMJSLayer::moveUp")};this.moveDown=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].moveLayerDown(this),
this.parentMaps[a].draw("WMJSLayer::moveDown")};this.zoomToLayer=function(){for(var a=0;a<this.parentMaps.length;a++)this.parentMaps[a].zoomToLayer(this)};this.draw=function(a){for(var b=0;b<this.parentMaps.length;b++)this.parentMaps[b].draw("WMJSLayer::draw::"+a)};this.handleReferenceTime=function(a,e){"reference_time"===a&&(a=this.getDimension("time"))&&(a.setStartTime(e),this.parentMaps&&0<this.parentMaps.length&&this.parentMaps[0].getListener().triggerEvent("ondimchange","time"))};this.setDimension=
function(a,e){for(var b,c=0;c<this.dimensions.length;c++)this.dimensions[c].name==a&&(b=this.dimensions[c]);if(0!=isDefined(b)&&0!=isDefined(e)&&(b.setValue(e),this.handleReferenceTime(a,e),1==b.linked))for(c=0;c<this.parentMaps.length;c++)this.parentMaps[c].setDimension(a,b.getValue())};this.configureDimensions=function(){var a=this.jsonlayer_v1_1_1;if(a){for(var e=toArray(a.Dimension),g=this.objectpath.length-1;0<=g;g--){var c=this.objectpath[g].Dimension;if(!isNull(c)&&isDefined(c))for(var f=0;f<
c.length;f++){var m=c[f];if(!isNull(m)&&isDefined(m)){for(var l=!1,d=0;d<e.length;d++)if(m.attr.name.toLowerCase()===e[g].attr.name.toLowerCase()){l=!0;break}l||e.push(m)}}}a=toArray(a.Extent);this.dimensions=[];c=!1;for(g=0;g<e.length;g++){"reference_time"===e[g].attr.name.toLowerCase()?(c=!0,f=new WMJSDimension({linked:!1})):f=new WMJSDimension;f.name=e[g].attr.name.toLowerCase();f.units=e[g].attr.units;for(d=0;d<a.length;d++)a[d].attr.name.toLowerCase()==f.name&&(f.values=a[d].value?a[d].value.trim():
"",a[d].attr["default"]?f.defaultValue=a[d].attr["default"].trim():(m=f.values.split("/"),1<m.length?f.defaultValue=m[1]:0<m.length&&(f.defaultValue=m[0])),a[d].value||(error("No extent defined for dim "+f.name+" in layer "+this.title),error("Using default value "+f.defaultValue),f.values=f.defaultValue));this.version==WMSVersion.version130&&(f.values=e[g].value,f.defaultValue=e[g].attr["default"]);d=f.defaultValue;0<this.parentMaps.length?(m=this.parentMaps[0].getDimension(f.name),isDefined(m)&&
m.linked&&(isDefined(m.currentValue)?(d=f.getClosestValue(m.currentValue),debug("WMJSLayer::configureDimensions Dimension "+f.name+" default value ["+d+"] is based on map value ["+m.currentValue+"]")):debug("WMJSLayer::configureDimensions Map dimension currentValue for "+f.name+" does not exist."))):debug("WMJSLayer::configureDimensions Layer has no parentmaps");f.setValue(d);f.parentLayer=this;isDefined(f.values)?this.dimensions.push(f):error("Skipping dimension "+f.name)}c&&(e=this.getDimension("reference_time"),
this.handleReferenceTime("reference_time",e.getValue()))}};this.parseLayer=function(b,e,g){var c=this;c.hasError=!1;var f=function(a){isDefined(b)&&b(a)},m=function(b,d){c.hasError=!0;c.lastError=d;c.title=I18n.service_has_error.text;error(d);f(b);isDefined(a.failure)&&a.failure(b,d)};c.WMJSService=WMJSgetServiceFromStore(this.service);c.WMJSService.getCapabilities(function(a){(function(a,b){function d(b,c,e){for(var f=[],g=0;g<e.length;g++)f.push(e[g]);f.push(b);for(e=0;e<b.length;e++)if(b[e].Layer){g=
c;try{g+=b[e].Title.value+"/"}catch(E){}d(toArray(b[e].Layer),g,f)}else if(b[e].Name&&b[e].Name.value==a.name){I(b[e],c,f);break}}if(0==b||void 0==b)a.title=I18n.service_has_error.text,a.abstract=I18n.not_available_message.text,m(a,I18n.unable_to_connect_server.text);else{try{var c=a.WMJSService.getCapabilityElement(b)}catch(D){m(a,D);return}a.version=a.WMJSService.version;var e=c.Layer;if(isDefined(e)){try{a.serviceTitle=e.Title.value}catch(D){a.serviceTitle="Unnamed service"}try{for(var g=c.Request.GetMap.Format,
l=0;l<g.length;l++)g[l].value.indexOf("24"),g[l].value.indexOf("32")}catch(D){error("This WMS service has no getmap formats listed: using image/png")}if(void 0==a.name||1>a.name.length)a.title=WMJSEmptyLayerTitle,a.abstract=I18n.not_available_message.text,f(a);else{var n=0,I=function(d,f,g){a.jsonlayer_v1_1_1=d;a.getmapURL=void 0;try{a.getmapURL=c.Request.GetMap.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(u){}isDefined(a.getmapURL)||(a.getmapURL=a.service,error("GetMap OnlineResource is not specified. Using default."));
a.getfeatureinfoURL=void 0;try{a.getfeatureinfoURL=c.Request.GetFeatureInfo.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(u){}isDefined(a.getfeatureinfoURL)||(a.getfeatureinfoURL=a.service,error("GetFeatureInfo OnlineResource is not specified. Using default."));a.getlegendgraphicURL=void 0;try{a.getlegendgraphicURL=c.Request.GetLegendGraphic.DCPType.HTTP.Get.OnlineResource.attr["xlink:href"]}catch(u){}isDefined(a.getlegendgraphicURL)||(a.getlegendgraphicURL=a.service,error("GetLegendGraphic OnlineResource is not specified. Using default."));
a.getmapURL=WMJScheckURL(a.getmapURL);a.getfeatureinfoURL=WMJScheckURL(a.getfeatureinfoURL);a.getlegendgraphicURL=WMJScheckURL(a.getlegendgraphicURL);a.getCapabilitiesDoc=b;a.title=d.Title.value;try{a.abstract=d.Abstract.value}catch(u){a.abstract=I18n.not_available_message.text}a.path=f;a.objectpath=g;a.styles=void 0;a.jsonlayer=a;try{f="";d.Style&&(f=toArray(d.Style));a.styles=f;for(var k=0;k<a.styles.length;k++){var l=a.styles[k];l.index=k;l.nrOfStyles=a.styles.length;l.title="default";l.name="default";
l.legendURL="";l.abstracttext="No abstract available";try{l.title=l.Title.value}catch(u){}try{l.name=l.Name.value}catch(u){}try{l.legendURL=l.LegendURL.OnlineResource.attr["xlink:href"]}catch(u){}try{l.abstracttext=l.Abstract.value}catch(u){}}""==a.currentStyle&&(a.currentStyle=a.styles[0].Name.value);a.setStyle(a.currentStyle)}catch(u){a.currentStyle="",a.styles="",error("No styles found for layer "+a.title)}a.configureDimensions();l=toArray(d.SRS);isDefined(d.CRS)&&(l=toArray(d.CRS));a.projectionProperties=
[];var m=[];f=function(b){if(isDefined(b.BoundingBox))for(b=toArray(b.BoundingBox),k=0;k<b.length;k++){var d=b[k].attr.SRS;isDefined(b[k].attr.CRS)&&(d=b[k].attr.CRS);d&&0<d.length&&(d=decodeURIComponent(d));for(var c=!1,e=0;e<a.projectionProperties.length;e++)if(d==a.projectionProperties[e].srs){c=!0;break}0==c&&(c=new WMJSProjection,c.srs=d,d=!1,a.version==WMSVersion.version130&&"EPSG:4326"==c.srs&&0==a.wms130bboxcompatibilitymode&&(d=!0),0==d?(c.bbox.left=parseFloat(b[k].attr.minx),c.bbox.bottom=
parseFloat(b[k].attr.miny),c.bbox.right=parseFloat(b[k].attr.maxx),c.bbox.top=parseFloat(b[k].attr.maxy)):(c.bbox.left=parseFloat(b[k].attr.miny),c.bbox.bottom=parseFloat(b[k].attr.minx),c.bbox.right=parseFloat(b[k].attr.maxy),c.bbox.top=parseFloat(b[k].attr.maxx)),a.projectionProperties.push(c),m.push(c.srs))}};f(d);f(e);for(k=0;k<l.length;k++)-1==m.indexOf(l[k].value)&&(f=new WMJSProjection,error("Warning: BoundingBOX missing for SRS "+l[k].value),f.bbox.left=-180,f.bbox.bottom=-90,f.bbox.right=
180,f.bbox.top=90,f.srs=l[k].value,a.projectionProperties.push(f));m="";a.queryable=!1;try{1==parseInt(d.attr.queryable)?a.queryable=!0:a.queryable=!1}catch(u){error("Unable to detect whether this layer is queryable (for layer "+a.title+")")}n=1},g=toArray(e.Layer),l=[];l.push(e);d(g,"",l);if(0==n)return g="",g=a.name?"Unable to find layer '"+a.name+"' in service '"+a.service+"'":"Unable to find layer '"+a.title+"' in service '"+a.service+"'",a.title="--- layer not found in service ---",a.abstract=
I18n.not_available_message.text,m(a,g),a;if(a.onReady)a.onReady(a);f(a);return a}}else m(a,"No Layer element in service")}})(c,a)},function(a){m(c,a)},e)};this.cloneLayer=function(){var a=new WMJSLayer;for(i in this)a[i]=this[i];return a};this.setName=function(a){this.name=a;this.parseLayer(void 0,void 0,"WMJSLayer::setName")};this.getLayerRelative=function(a,e,g){isDefined(g)||(g=0);var b=this;b.WMJSService.getLayerObjectsFlat(function(c){for(var f=-1,l=0;l<c.length;l++)if(c[l].name==b.name){f=l;
break}-1==f?e("Current layer ["+b.name+"] not in this service"):(-1===g&&f--,1===g&&f++,f>c.length-1&&(f=0),0>f&&(f=c.length-1),a(c[f],f,c.length))},e)};this.autoSelectLayer=function(a,e){this.WMJSService.getLayerObjectsFlat(function(b){for(var c=0;c<b.length;c++)if(isDefined(b[c].name)&&-1==b[c].name.indexOf("baselayer")&&-1==b[c].path.indexOf("baselayer")){a(b[c]);break}},e)};this.getNextLayer=function(a,e){this.getLayerRelative(a,e,1)};this.getPreviousLayer=function(a,e){this.getLayerRelative(a,
e,-1)};this.setStyle=function(a){debug("WMJSLayer::setStyle: "+a);if(0==this.styles.length)this.legendGraphic=this.currentStyle="",debug("Layer has no styles.");else{for(var b=0;b<this.styles.length;b++)if(this.styles[b].name==a){this.legendGraphic=this.styles[b].legendURL;this.currentStyle=this.styles[b].name;return}debug("WMJSLayer::setStyle: Style "+a+" not found, setting style "+this.styles[0].name);this.currentStyle=this.styles[0].name;this.legendGraphic=this.styles[0].legendURL}};this.getStyleObject=
function(a,e){if(0!=isDefined(this.styles))for(var b=0;b<this.styles.length;b++)if(this.styles[b].name==a)return-1===e&&b--,1===e&&b++,0>b&&(b=this.styles.length-1),b>this.styles.length-1&&(b=0),this.styles[b].nrOfStyles=this.styles.length,this.styles[b].index=b,this.styles[b]};this.getStyle=function(){return this.currentStyle};this.setService=function(a){this.getgraphinfoURL=this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a};this.getDimension=function(a){for(var b=0;b<
this.dimensions.length;b++)if(this.dimensions[b].name==a)return this.dimensions[b]};this.getProjection=function(a){for(var b=0;b<this.projectionProperties.length;b++)if(this.projectionProperties[b].srs==a)return a=[],a.srs=this.projectionProperties[b].srs+"",a.bbox=new WMJSBBOX(this.projectionProperties[b].bbox.left,this.projectionProperties[b].bbox.bottom,this.projectionProperties[b].bbox.right,this.projectionProperties[b].bbox.top),a};this.display=function(a){this.enabled=a;for(a=0;a<this.parentMaps.length;a++)this.parentMaps[a].displayLayer(this,
this.enabled)};a&&(this.getlegendgraphicURL=this.getfeatureinfoURL=this.getmapURL=this.service=a.service,this.name=a.name,a.getgraphinfoURL&&(this.getgraphinfoURL=a.getgraphinfoURL),a.style&&(this.currentStyle=a.style),this.format=a.format?a.format:"image/png",a.opacity&&(this.opacity=a.opacity),a.title&&(this.title=a.title),this.abstract=I18n.not_available_message.text,!1===a.enabled&&(this.enabled=!1),1==a.keepOnTop&&(this.keepOnTop=!0),!0===a.transparent&&(this.transparent=!0),!1===a.transparent&&
(this.transparent=!1),isDefined(a.onReady)&&(this.onReady=a.onReady,this.parseLayer(void 0,void 0,"WMJSLayer::configOptions")),isDefined(a.type)&&(this.type=a.type))};function WMJSBBOX(a,b,e,g){this.left=-180;this.bottom=-90;this.right=180;this.top=90;this.clone=function(a){void 0==a&&(a=this);var b=new WMJSBBOX;b.left=a.left;b.bottom=a.bottom;b.right=a.right;b.top=a.top;return b};this.copy=function(a){this.setBBOX(a)};this.setBBOX=function(a,b,e,g){if(void 0===a||null===a)this.left=-180,this.bottom=-90,this.right=180,this.top=90;else{if(!b)if("object"===typeof a){var d=a;void 0===d.length||null===d.length?(a=d.left,b=d.bottom,e=d.right,g=d.top):(a=parseFloat(d[0]),
b=parseFloat(d[1]),e=parseFloat(d[2]),g=parseFloat(d[3]))}else try{d=a.split(","),4!==d.length&&error("Invalid map bounding box: '"+a+"'"),a=parseFloat(d[0]),b=parseFloat(d[1]),e=parseFloat(d[2]),g=parseFloat(d[3])}catch(n){}if(void 0===a||void 0===b||void 0===e||void 0===g||null===a||null===b||null===e||null===g)void 0==a&&(a=-180),void 0==e&&(e=180),void 0==b&&(b=-90),void 0==g&&(g=90);this.left=a;this.bottom=b;this.right=e;this.top=g}};this.equals=function(b,e,g,l){if(!b)return!1;if(void 0!==e&&
this.left===b&&this.right===g&&this.top===l&&this.bottom===e)return!0;if("object"===typeof b){if(this.left===b.left&&this.right===b.right&&this.top===b.top&&this.bottom===b.bottom)return!0}else if(l=b.split(","),4!==l.length&&console.log("Invalid map bounding box: "+b),a=parseFloat(l[0]),e=parseFloat(l[1]),g=parseFloat(l[2]),l=parseFloat(l[3]),b=0,this.left===a&&b++,this.right===g&&b++,this.top===l&&b++,this.bottom===e&&b++,2<=b)return!0;return!1};this.toString=function(){return this.left+","+this.bottom+
","+this.right+","+this.top};this.setBBOX(a,b,e,g)};WMJSDateOutSideRange="outside range";WMJSDateTooEarlyString="date too early";WMJSDateTooLateString="date too late";
function WMJSDimension(a){this.timeRangeDuration=this.parentLayer=this.defaultValue=this.currentValue=this.values=this.units=this.name=void 0;this.linked=!0;var b=this;isDefined(a)&&(isDefined(a.name)&&(this.name=a.name),isDefined(a.units)&&(this.units=a.units),isDefined(a.values)&&(this.values=a.values),isDefined(a.currentValue)&&(this.currentValue=a.currentValue),isDefined(a.defaultValue)&&(this.defaultValue=a.defaultValue),isDefined(a.parentLayer)&&(this.parentLayer=a.parentLayer),isDefined(a.linked)&&
(this.linked=a.linked));var e=!1,g,c=[],f,m=[];this.setStartTime=function(a){e||l(this);if(a&&0!==a.length)if(a=parseISO8601DateToDate(a).toISO8601(),"timestartstopres"===f){var d=b.values;a+=d.substring(d.indexOf("/"));b.reInitializeValues(a);b.setClosestValue()}else{if("timevalues"===f){var g=parseISO8601DateToDate(a);console.log(g);a=arr.filter(function(a){return c[m]>=g});for(var d="",m=0;m<a.length;m++)0<m&&(d+="/"),d+=a[m].toISO8601();console.log(d);b.reInitializeValues(d);b.setClosestValue()}}else b.reInitializeValues(b.values),
timeDim.setClosestValue(!0),console.log("returning")};b.reInitializeValues=function(a){e=!1;l(b,a)};var l=function(a,b){if(1!=e){var d=a.values;b&&(d=b);if(isDefined(d)){m=[];e=!0;"ISO8601"==a.units?0<d.indexOf("/")?(f="timestartstopres",g=new parseISOTimeRangeDuration(d)):f="timevalues":(f="anyvalue",a.linked=!1);if("timestartstopres"!=f){b=d.split(",");for(var l=0;l<b.length;l++){var n=b[l].split("/");if(3==n.length)for(l=parseFloat(n[0]),d=parseFloat(n[1]),n=parseFloat(n[2]),d+=n,l>d&&(d=l),0>=
n&&(n=1);l<d;l+=n)m.push(l);else m.push(b[l])}if("timevalues"==f)for(l=0;l<m.length;l++)c[l]=parseISO8601DateToDate(m[l])}isDefined(a.defaultValue)||(a.defaultValue=a.getValueForIndex(0));isDefined(a.currentValue)||(a.currentValue=a.getValueForIndex(0));a.dimMinValue=a.getValueForIndex(0);a.dimMaxValue=a.getValueForIndex(a.size()-1)}}};b.getValue=function(){e||l(b);var a=this.defaultValue;isDefined(this.currentValue)&&(a=b.currentValue);return a=b.addTimeRangeDurationToValue(a)};this.setValue=function(a){e||
l(b);a!=WMJSDateOutSideRange&&a!=WMJSDateTooEarlyString&&a!=WMJSDateTooLateString&&(this.currentValue=a)};this.setClosestValue=function(a,b){a||(a=this.getValue(),b=!0);this.currentValue=this.getClosestValue(a,b)};this.getNextClosestValue=function(a){var b=this.getClosestValue(a),b=this.getIndexForValue(b),b=this.getValueForIndex(b+1);return!b||"date too early"===b||moment(a)>=moment(b)?null:b};this.addTimeRangeDurationToValue=function(a){if(a==WMJSDateOutSideRange||a==WMJSDateTooEarlyString||a==
WMJSDateTooLateString)return a;if(b.timeRangeDuration&&0<b.timeRangeDuration.length){var d=parseISO8601IntervalToDateInterval(b.timeRangeDuration),c=parseISO8601DateToDate(a);c.add(d);d=c.toISO8601();return a+"/"+d}return a};this.setTimeRangeDuration=function(a){if((b.timeRangeDuration=a)&&0<a.length){b.reInitializeValues(b.values);a=parseISO8601DateToDate(b.dimMinValue);var d=b.dimMaxValue,c=parseISO8601IntervalToDateInterval(b.timeRangeDuration);0!=c.second&&a.setUTCSeconds(0);0!=c.minute&&(a.setUTCSeconds(0),
a.setUTCMinutes(0));0!=c.hour&&(a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCSHours(0));0!=c.day&&(a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCSHours(0),a.setUTCDate(0));0!=c.month&&(a.setUTCSeconds(0),a.setUTCMinutes(0),a.setUTCSHours(0),a.setUTCDate(0));b.reInitializeValues(a.toISO8601()+"/"+d+"/"+b.timeRangeDuration)}else console.log("reset"),b.reInitializeValues(b.values)};this.getClosestValue=function(a,b){a&&-1!=a.indexOf("/")&&(a=a.split("/")[0]);b="undefined"!==typeof b?b:!1;var c=-1,d=
WMJSDateOutSideRange;try{c=this.getIndexForValue(a),d=this.getValueForIndex(c)}catch(C){"number"===typeof C&&(d=0==C?WMJSDateTooEarlyString:WMJSDateTooLateString)}"current"==a||"default"==a||""==a?d=this.defaultValue:"latest"==a||b&&d===WMJSDateTooLateString?d=this.getValueForIndex(this.size()-1):"earliest"==a||b&&d===WMJSDateTooEarlyString?d=this.getValueForIndex(0):"middle"==a&&(a=this.size()/2-1,0>a&&(a=0),d=this.getValueForIndex(a));return d};this.getValueForIndex=function(a){l(this);if(0>a)return-1==
a?WMJSDateTooEarlyString:-2==a?WMJSDateTooLateString:-1;if("timestartstopres"==f){try{return g.getDateAtTimeStep(a).toISO8601()}catch(n){}return g.getDateAtTimeStep(a)}if("timevalues"==f||"anyvalue"==f)return m[a]};this.get=function(a){return this.getValueForIndex(a)};this.getIndexForValue=function(a,b){l(this);isDefined(b)||(b=!0);if("string"===typeof a&&"current"==a&&"current"!=this.defaultValue)return this.getIndexForValue(this.defaultValue);if("timestartstopres"==f)try{return"string"===typeof a?
g.getTimeStepFromISODate(a,b):g.getTimeStepFromDate(a,b)}catch(v){return 0==parseInt(v)?-1:-2}if("timevalues"==f)try{var d=parseISO8601DateToDate(a).getTime(),e;for(b=a=0;b<m.length;b++){var n=c[b].getTime()-d;0>n&&(n=-n);0==b&&(e=n);n<e&&(e=n,a=b)}return a}catch(v){return error("WMSJDimension::getIndexForValue,2: "+v),-1}if("anyvalue"==f)for(b=0;b<m.length;b++)if(m[b]==a)return b;return-1};this.size=function(){l(this);if("timestartstopres"==f)return g.getTimeSteps();if("timevalues"==f||"anyvalue"==
f)return m.length};this.clone=function(){var a=new WMJSDimension;a.name=b.name;a.units=b.units;a.values=b.values;a.initialize();a.currentValue=b.currentValue;a.defaultValue=b.defaultValue;a.parentLayer=b.parentLayer;a.linked=b.linked;return a};this.initialize=function(){l(this)}};var WMSVersion={version100:"1.0.0",version111:"1.1.1",version130:"1.3.0"};String.prototype.startsWith||(String.prototype.startsWith=function(a,b){b=b||0;return this.indexOf(a,b)===b});
var loadGetCapabilitiesViaProxy=function(a,b,e,g){var c=g+"request=",f=function(a){e(I18n.unable_to_do_getcapabilities.text+":\n"+c+"\n"+I18n.result.text+":\n"+a)};debug("<a target='_blank' href='"+a+"'>"+a+"</a>",!1);c+=URLEncode(a);console.log("loadGetCapabilitiesViaProxy wrapped",c);debug(c);debug(URLEncode(a));debug(a);try{$.ajax({url:c,crossDomain:!0,dataType:"jsonp"}).done(function(a){console.log("loadGetCapabilitiesViaProxy succesfully finished");b(a)}).fail(function(){f({error:"Request failed for "+
c})})}catch(m){console.log("catch: ",m),f({error:"Request failed for "+c})}},WMJSGetCapabilities=function(a,b,e,g){console.log(a);if(0==isDefined(a))console.log("Service not defined"),g(I18n.no_service_defined.text);else if(0==a.length)console.log("Service is empty"),g(I18n.service_url_empty.text);else if(a.startsWith("http://")||a.startsWith("https:")||a.startsWith("//")){-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");var c=a+"&service=WMS&request=GetCapabilities";(new WMJSXMLParser).fetchXMLAndParseToJSON(c,
e,function(){console.log("Unable to use browser based XML reading, trying proxy");loadGetCapabilitiesViaProxy(c,e,function(){g("Request failed for "+c)},xml2jsonrequestURL)})}else console.log("Service does not start with HTTPS"),g(I18n.service_url_empty.text)},WMJSServiceStore=[],WMJSgetServiceFromStore=function(a){for(var b=0;b<WMJSServiceStore.length;b++)if(WMJSServiceStore[b].service==a)return WMJSServiceStore[b];a=new WMJSService({service:a});WMJSServiceStore.push(a);return a};
function WMJSService(a){function b(a,b){return a.sort(function(a,c){a=a[b];c=c[b];return a<c?-1:a>c?1:0})}this.abstract=this.onlineresource=this.title=this.service=void 0;this.version=WMSVersion.version111;this.getcapabilitiesDoc=void 0;this.busy=!1;var e,g=this;a&&(this.service=a.service,this.title=a.title);this.getCapabilityElement=function(a){try{var b=a.WMT_MS_Capabilities.Capability}catch(l){try{b=a.WMS_Capabilities.Capability}catch(d){throw I18n.no_capability_element_found.text;}}if(!isDefined(b))throw I18n.no_capability_element_found.text;
return b};this.checkVersion=function(a){var b=null;try{WMSVersion.version100==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==a.WMT_MS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(l){try{WMSVersion.version100==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version100),WMSVersion.version111==a.WMS_Capabilities.attr.version&&(b=WMSVersion.version111),WMSVersion.version130==
a.WMS_Capabilities.attr.version&&(b=WMSVersion.version130)}catch(d){console.log("165");if(a=g.checkException(a))throw console.log(a),Error(a);throw Error("Unable to determine WMS version");}}if(null===b)throw Error("Unable to determine WMS version");return b==WMSVersion.version111||b==WMSVersion.version130?b:WMSVersion.version111};var c=[];this.getCapabilities=function(a,b,g){e=void 0;var d=this;if(this.busy)a={callback:a,fail:b},c.push(a);else if(d.getcapabilitiesDoc&&1!=g)a(this.getcapabilitiesDoc);
else{d.busy=!0;var f=function(a){console.log("Failed");d.busy=!1;for(var b=0;b<c.length;b++)c[b].fail(a),c[b].fail=function(){};c=[]};a={callback:a,fail:b};c.push(a);WMJSGetCapabilities(this.service,!1,function(a){d.busy=!1;d.getcapabilitiesDoc=a;try{d.version=d.checkVersion(a)}catch(C){console.log("version error",C);f(C.message);return}var b=a.WMS_Capabilities;b||(b=a.WMT_MS_Capabilities);try{d.abstract=b.Service.Abstract.value}catch(C){this.abstract=I18n.not_available_message.text}try{d.title=b.Service.Title.value}catch(C){this.title=
I18n.not_available_message.text}try{d.onlineresource=b.Service.OnlineResource.value?b.Service.OnlineResource.value:b.Service.OnlineResource.attr["xlink:href"]}catch(C){d.onlineresource=I18n.not_available_message.text}for(b=0;b<c.length;b++)c[b].callback(a),c[b].callback=function(){};c=[];d.busy=!1},f)}};this.checkException=function(a){console.log("271");try{if(a.ServiceExceptionReport){var b="Undefined",c=b,d=a.ServiceExceptionReport.ServiceException;if(d){try{d.attr.code&&(b=d.attr.code)}catch(n){}if(d.value)return c=
d.value,"Exception: "+b+".\n"+c}return I18n.wms_service_exception_code.text+b}}catch(n){}};this.getNodes=function(a,c,e){this.nodeCache=void 0;c||(c=function(a){error(a)});var d=function(d){function e(a,c,d){for(var f=0;f<a.length;f++){var g=!1;a[f].Name&&(g=!0);try{a[f].Layer&&(g=!1)}catch(R){}a[f].Name?g={name:a[f].Name.value,text:a[f].Title.value,leaf:g,path:d}:(isNull(a[f].Title)&&(a[f].Title=[],a[f].Title.value="Layer"),g={text:a[f].Title.value,leaf:g});c.push(g);a[f].Layer&&(g.children=[],e(toArray(a[f].Layer),
g.children,d+a[f].Title.value))}b(c,"text")}var f={},l=g.getCapabilityElement(d).Layer;try{g.version=g.checkVersion(d)}catch(v){c(v);return}d=toArray(l.Layer);try{f.text=l.Title.value}catch(v){f.text=I18n.unnamed_service.text}f.leaf=!1;f.expanded=!0;f.children=[];e(d,f.children,"");a(f)};this.getCapabilities(function(a){d(a)},function(a){c(a)},e)};this.getLayerNames=function(a,b){this.getNodes(function(b){var c=[],e=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b].name),a[b].children&&
e(a[b].children)};e(b.children);a(c)},b)};this.getLayerObjectsFlat=function(a,b){isDefined(e)&&a(e);this.getNodes(function(b){var c=[],e=function(a){for(var b=0;b<a.length;b++)a[b].name&&c.push(a[b]),a[b].children&&e(a[b].children)};e(b.children);a(c)},b)}};function WMJSListener(){function a(){this.functionpointer=this.name=void 0;this.finished=0;this.keepOnCall=!1}var b=[],e=0,g=[],c=this;this.addToCallback=function(c,g,l){var d=-1;l||(l=!1);for(var f=0;f<e;f++){if(1===b[f].finished){d=f;break}if(b[f].name===c&&b[f].functionpointer===g)return b[f].keepOnCall=l,!1}-1===d&&(d=e,e++,b[d]=new a);b[d].name=c;b[d].functionpointer=g;b[d].finished=0;b[d].keepOnCall=l;return!0};this.removeEvents=function(a,c){for(var f=0;f<e;f++)0===b[f].finished&&b[f].name===
a&&(c?b[f].functionpointer===c&&(b[f].finished=1):b[f].finished=1)};this.suspendEvent=function(a){g[a]=!0};this.resumeEvent=function(a){g[a]=!1};this.triggerEvent=function(a,m){if(!0!==g[a]){for(var f=[],d=0,n=0;n<e;n++)if(0===b[n].finished&&b[n].name===a){!1===b[n].keepOnCall&&(b[n].finished=1);try{d++,f.push(b[n].functionpointer(m,c))}catch(q){console.log("Error for event ["+a+"]: ",m,q)}}return f}}};function WMJSTimer(){function a(){g&&clearTimeout(e);g=!1}function b(){0==f?(a(),""!=l&&l()):(--f,g=!0,e=self.setTimeout(function(){b()},c))}this.init=function(c,e){f=parseInt(c/10+.5);1>f&&(f=1);m=f;l=e;a();0<f&&b()};this.reset=function(){f=m};this.stop=function(){a()};var e=null,g=!1,c=10,f,m,l=""}var WMJSDebouncer=function(){var a=!1,b=10,e=!1;this.init=function(g,c){e=!1;b=g;10>b&&(b=10);!1===a&&(self.setTimeout(function(){a=!1;!1===e&&c()},b),a=!0)};this.stop=function(){e=!0}};var sliderTooltip=function(a){isDefined(a)?(a='<div class="slidertooltip"><div class="slidertooltip-inner">'+a+"</div></div>",$(".relativecontrol .ui-slider-handle").html(a)):$(".ui-slider-handle .relativecontrol").html("")},RelativeSlider=function(a){var b=this,e=a.renderTo;$('<input class="datetimepicker"/><br/><span class="relativeslider"/><span class="timeprevious"/><span class="timenext"/>').appendTo(e);var g=0,c=function(c){g+=c;NaN<g&&(g=NaN);0>g&&(g=0);isDefined(a.change)&&a.change(b,g)},
f=e.find(".relativeslider").slider({min:0,max:100,value:50,animate:1E3,change:function(a,b){a.originalEvent&&(a=parseInt(b.value-50),c(a),50!=b.value&&f.slider("value",50))},slide:function(c,d){d=parseInt(d.value-50);c=g;d=g+d;void 0<d&&(d=void 0);0>d&&(d=0);isDefined(a.slide)&&a.slide(b,d);g=c}});f.addClass("relativecontrol");e.find(".timeprevious").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-w"}});e.find(".timenext").iconbutton({text:!1,icons:{primary:"ui-icon-circle-triangle-e"}});
e.find(".timeprevious").click(function(){c(-1)});e.find(".timenext").click(function(){c(1)});var m=e.find(".datetimepicker").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",separator:"T",showOn:"button",buttonText:"",altFieldTimeOnly:!1,showAnim:"slideDown",changeMonth:!0,changeYear:!0,showTimezone:!1,onSelect:function(a,c){c=b.setPositionByText(a);a!=c.dimvalue&&m.datetimepicker("setDate",c.dimvalue.replace("Z",""))},css:{zIndex:4E3}});this.setPosition=function(a){g=a};this.setPositionByText=
function(c){if(isDefined(a.textUpdate))return a.textUpdate(b,c)};this.setText=function(a,b){a=a.replace("Z","");e.find(".datetimepicker").val(a)};this.setMax=function(a,b,c){m.datetimepicker("option",{minDate:b.replace("Z",""),maxDate:c.replace("Z","")})}},TimeSlider=function(a){var b,e;this.setDimension=function(a,c,f){b=a;isDefined(void 0)&&(void 0).setMax(a.size(),a.getValueForIndex(0),a.getValueForIndex(a.size()-1));e="";this.setValue(a.name,a.getValue())};this.setValue=function(a,c){if(isDefined(b)&&
"time"==a&&e!=c){e=c;try{var f=b.getIndexForValue(c)}catch(m){f=b.size()-1,c=b.getValueForIndex(f),debug("Date "+c+" is outside range: "+f)}isDefined(void 0)&&((void 0).setText(c),(void 0).setPosition(f));return{index:f,dimvalue:c}}}};var WMJSProcessing=function(a){var b=a.url,e=!1;a.failure||(a.failure=function(a){alert(dump(a))});var g=function(b){try{var c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessAccepted"].value}catch(q){}if(isDefined(c)){var g=b["wps:ExecuteResponse"].attr.statusLocation,l=new WMJSTimer,d=function(b){if(0!=e){if(b.error){var c=!0;var d=b.error}try{c=!0,d=dump(b.ExceptionReport.Exception)}catch(I){}try{c=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"],d="Process failed",d=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessFailed"]["wps:ExceptionReport"]["ows:Exception"]["ows:ExceptionText"].value}catch(I){}if(isDefined(c))e=
!1,a.failure({message:d});else{try{var f=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessSucceeded"].value}catch(I){}try{var g=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].attr.percentCompleted;var l=b["wps:ExecuteResponse"]["wps:Status"]["wps:ProcessStarted"].value;0==l.indexOf("processstarted")&&(l=l.substr(14))}catch(I){}isDefined(f)?(f=b["wps:ExecuteResponse"]["wps:ProcessOutputs"]["wps:Output"],a.progress(100,"completed"),a.success(f,b),e=!1):a.progress(parseFloat(g),l)}}},
n=function(){$.ajax({dataType:"jsonp",url:xml2jsonrequestURL+"request="+URLEncode(g),data:"",success:d}).fail(function(b){e=!1;a.failure({message:"<h1>Invalid JSON returned from server:</h1><hr/>"+b.responseText})});e&&l.init(1E3,n)};n()}else{c="";try{c=dump(b.ExceptionReport.Exception.attr),a.failure({message:"Process was not accepted, ExceptionReport:\n"+c})}catch(q){b.error?(b.message||(b.message=b.error),a.failure(b)):(c=dump(b),a.failure({message:"Process was not accepted (dump):\n"+c}))}}};
this.execute=function(c,f){e=!0;c=b+"service=WPS&request=execute&identifier="+c+"&version=1.0.0&storeExecuteResponse=true&status=true&";c+="datainputs=";var m="",l;for(l in f)if("object"===typeof f[l])for(var d in f[l])0<m.length&&(m+=";"),m+=l+"="+encodeURIComponent(f[l][d]);else 0<m.length&&(m+=";"),m+=l+"="+encodeURIComponent(f[l]);$.ajax({dataType:"jsonp",url:xml2jsonrequestURL,data:{request:c+m},success:g}).fail(function(b){a.failure({message:b.responseText})})}};var WMJSCoverage=function(a){this.service=this.name=void 0;this.dimensions=[];this.supportedProjections=[];this.nativeFormat=this.nativeCRS=this.originY=this.originX=this.cellsizeY=this.cellsizeX=this.height=this.width=void 0;this.formats=[];this.setDimension=function(a,e){this.dimensions.push({name:a,value:e,currentValue:e})};isDefined(a)&&(this.name=a.name,this.service=a.service)},WCJSRequest=function(a,b,e,g){var c=xml2jsonrequestURL+"request=";-1==a.indexOf("?")&&(a+="?");debug("GetCapabilities:");
var f=a+"&service=WCS&REQUEST=DescribeCoverage&COVERAGE="+b;debug("<a target='_blank' href='"+f+"'>"+f+"</a>",!1);c+=URLEncode(f);$.ajax({dataType:"jsonp",url:c,success:function(c){c.service=a;c.name=b;e(c)},error:function(a){g(I18n.unable_to_do_getcapabilities.text+":\n"+c+"\n"+I18n.result.text+":\n"+a)}})},parseDescribeCoverage=function(a,b){b=b?b:new WMJSCoverage;b.service=a.service;try{b.name=a.CoverageDescription.CoverageOffering.name.value}catch(l){alert("This layer has no Web Coverage Service.");
return}b.title=a.CoverageDescription.CoverageOffering.label.value;b["abstract"]=a.CoverageDescription.CoverageOffering.description.value;var e=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][0].value.replaceAll(" ",",");var g=a.CoverageDescription.CoverageOffering.lonLatEnvelope["gml:pos"][1].value.replaceAll(" ",",");b.lonlatbox=new WMJSBBOX(e+","+g);for(var c=toArray(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:Envelope"]),f=0;f<c.length;f++){var m=c[f].attr.srsName;
e=c[f]["gml:pos"][0].value.replaceAll(" ",",");g=c[f]["gml:pos"][1].value.replaceAll(" ",",");g=new WMJSBBOX(e+","+g);b.supportedProjections.push({srs:m,bbox:g.toString()})}f=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:limits"]["gml:GridEnvelope"]["gml:high"].value.split(" ");b.width=parseInt(f[0])+1;b.height=parseInt(f[1])+1;b.cellsizeX=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][0].value.split(" ")[0]);
b.cellsizeY=parseFloat(a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:offsetVector"][1].value.split(" ")[1]);b.originX=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[0];b.originY=a.CoverageDescription.CoverageOffering.domainSet.spatialDomain["gml:RectifiedGrid"]["gml:origin"]["gml:pos"].value.split(" ")[1];b.nativeCRS=a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs?
a.CoverageDescription.CoverageOffering.supportedCRSs.nativeCRSs.value:"EPSG:4326";b.nativeFormat=a.CoverageDescription.CoverageOffering.supportedFormats.attr.nativeFormat;a=toArray(a.CoverageDescription.CoverageOffering.supportedFormats.formats);for(f=0;f<a.length;f++)b.formats.push(a[f].value);return b};var WMJSImage=function(a,b,e,g){var c=this,f=!0;isDefined(g)&&isDefined(g.randomizer)&&!1===g.randomizer&&(f=!1);var m,l,d,n,q;c.init=function(){m="undefined image";n=d=l=!1;q=1};c.init();this.srcToLoad=a;c.isLoaded=function(){return d?!1:l};c.isLoading=function(){return d};c.checkIfThisSourceIsSet=function(a){return m==a||this.srcToLoad==a?!0:!1};c.setSource=function(a){d?console.log("-------------------------\x3e Source set while still loading!!! "):(this.srcToLoad=a,l=m==this.srcToLoad?!0:!1)};
c.clear=function(){c.init()};c.getSrc=function(){return this.srcToLoad};c.hasError=function(){return n};c.load=function(){n=!1;1==l?w(c,!1):(d=!0,this.srcToLoad?!1===this.srcToLoad.startsWith("http")&&!1===this.srcToLoad.startsWith("//")?(console.log("Source does not start with http"),w(c,!0)):this.srcToLoad==m?w(c,!1):(C.load(function(){w(c,!1)}),C.error(function(a){w(c,!0)}),f?C.attr("src",this.srcToLoad+"&"+Math.random()):C.attr("src",this.srcToLoad)):(console.log("Source not set"),w(c,!0)))};
var w=function(a,e){n=e;d=!1;l=!0;m=this.srcToLoad;isDefined(b)&&b(c)};c.setOpacity=function(a){q=parseFloat(a);C.css("opacity",q)};c.getOpacity=function(a){return q};c.setPosition=function(a,b){C.css({top:parseInt(b)+"px",left:parseInt(a)+"px",position:"absolute"})};c.setSize=function(a,b){a=parseInt(a);b=parseInt(b);0===a||0===b||isNaN(a)||isNaN(b)||(C.width(parseInt(a)+"px"),C.height(parseInt(b)+"px"))};c.setZIndex=function(a){C.zIndex=a};c.getElement=function(){return C};var C=$(document.createElement("img"));
C.onselectstart=function(){return!1};C.ondrag=function(){return!1};return c};function WMJSXMLParser(){this.fetchXMLAndParseToJSON=function(a,b,e){$.ajax({url:a,crossDomain:!0,xhrFields:{withCredentials:!0}}).done(function(a){var c={},f=function(a,b,c){if(a.children&&a.children.length)for(var d=0;d<a.children.length;d++){var e=a.children[d],g=b+"->"+e.nodeName,l=e.nodeName;if(c[l]){var m={attr:{}};if(!(c[l]instanceof Array)){var z=Object.assign({},c[l]);c[l]=[];c[l].push(z)}c[l].push(m)}else c[l]={attr:{}},m=c[l];e.childNodes&&0<e.childNodes.length&&e.childNodes[0].nodeValue&&
(l=e.childNodes[0].nodeValue.trim(),"\n"!==l&&0<l.length&&(m.value=l));if(e.attributes&&0<e.attributes.length)for(l=0;l<e.attributes.length;l++)m.attr[e.attributes[l].name]=e.attributes[l].value;f(e,g,m)}};f(a,"",c);try{console.log("WMJSXMLParser succesfully completed",c),b(c)}catch(m){e({error:"WMJSXMLParser: ready failed",exception:m})}}).fail(function(b){e({error:"WMJSXMLParser: Request failed for "+a,exception:b})})}};var WMJSCanvasBuffer=function(a,b,e,g,c){var f=this;this.canvas=$("<canvas/>",{"class":"WMJSCanvasBuffer"}).width(g).height(c);var m=f.canvas[0].getContext("2d");m.canvas.width=g;m.canvas.height=c;this.hidden=this.ready=!0;this.layerstodisplay=[];this.layers=[];var l=g,d=c;"imagebuffer"===b&&this.canvas.addClass("wmjsimagebuffer");"legendbuffer"===b&&this.canvas.addClass("wmjslegendbuffer");this.canvas.addClass("WMJSCanvasBuffer-noselect");this.getCanvasContext=function(){return m};this.imageLoadComplete=
function(c){n();a.triggerEvent("onimageload");"imagebuffer"===b&&a.triggerEvent("onimagebufferimageload",c)};var n=function(){for(var a=0;a<f.layers.length;a++)if(!1===f.layers[a].isLoaded())return;f.finishedLoading()},q=new WMJSImage("webmapjs/img/stoploading.png",function(){console.log("fake image loaded");n()},b);this.hide=function(){f.hidden=!0;f.canvas.hide();f.layers=[]};this.display=function(c,e){var g=[];if(c&&!e)console.log("skipping WMJSCanvasBuffer:display because newbbox is undefined");
else{f.hidden=!1;m.globalAlpha=1;"legendbuffer"===b&&m.clearRect(0,0,l,d);"imagebuffer"===b&&(m.beginPath(),m.rect(0,0,l,d),m.fillStyle="white",m.fill(),a.triggerEvent("beforecanvasstartdraw",m));if(c){var n=w({x:e.left,y:e.top},c);var r=w({x:e.right,y:e.bottom},c)}for(var k=e=0;k<f.layerstodisplay.length;k++)if(f.layerstodisplay[k].setSize(l,d),!1===f.layerstodisplay[k].hasError()){var q=f.layerstodisplay[k].getOpacity();m.globalAlpha=q;q=f.layerstodisplay[k].getElement()[0];if("legendbuffer"===
b){var z=parseInt(q.width)+4,v=parseInt(q.height)+4;e+=z+4;var u=l-e+2,C=d-v-2;m.beginPath();m.fillStyle="#FFFFFF";m.lineWidth=.3;m.globalAlpha=.5;m.strokeStyle="#000000";m.rect(parseInt(u)+.5,parseInt(C)+.5,z,v);m.fill();m.stroke();m.globalAlpha=1;m.drawImage(q,u,C)}else c?(z=parseInt(n.x+.5),v=parseInt(n.y+.5),u=parseInt(r.x-n.x+.5),C=parseInt(r.y-n.y+.5),u===parseInt(m.canvas.width)&&C===parseInt(m.canvas.height)?m.drawImage(q,z,v):m.drawImage(q,z,v,u,C)):m.drawImage(q,0,0,l,d)}else g.push(f.layerstodisplay[k]);
m.globalAlpha=1;"imagebuffer"===b&&0<g.length&&a.triggerEvent("canvasonerror",g);"imagebuffer"===b&&a.triggerEvent("beforecanvasdisplay",m);f.canvas.show();"imagebuffer"===b&&a.triggerEvent("aftercanvasdisplay",m)}};this.finishedLoading=function(){if(!f.ready){f.ready=!0;for(var a=0;a<f.layers.length;a++)f.layerstodisplay[a]=f.layers[a],f.layers[a].hasError()&&error("Unable to get image <a target='_blank' href='"+f.layerstodisplay[a].getSrc()+"'>"+f.layerstodisplay[a].getSrc()+"</a>",!1);try{if(isDefined(f.onLoadReadyFunction))f.onLoadReadyFunction(f)}catch(r){error("Exception in Divbuffer::finishedLoading: "+
r)}}};this.setPosition=function(a,b){console.log("setPosition is deprecated")};this.setSize=function(a,b){console.log("setSize is deprecated")};this.resize=function(a,b){a=parseInt(a);b=parseInt(b);if(l!==a||d!==b)l=a,d=b,f.canvas.width(a),f.canvas.height(b),m.canvas.height=b,m.canvas.width=a};this.load=function(a){if(!1!==f.ready){f.ready=!1;f.layerstodisplay=[];a?this.onLoadReadyFunction=a:f.onLoadReadyFunction=function(){};for(a=f.nrLoading=0;a<this.layers.length;a++)f.layers[a].loadThisOne=!1,
!1===f.layers[a].isLoaded()&&(f.layers[a].loadThisOne=!0,f.nrLoading++);if(0===this.nrLoading)n();else{"imagebuffer"===b&&debug("GetMap:");"legendbuffer"===b&&debug("GetLegendGraphic:");for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&debug("<a target='_blank' href='"+this.layers[a].getSrc()+"'>"+this.layers[a].getSrc()+"</a>",!1);for(a=0;a<this.layers.length;a++)!0===this.layers[a].loadThisOne&&this.layers[a].load()}}};this.setSrc=function(a,b,c,d,f){if(isDefined(b)){for(;a>=this.layers.length;)this.layers.push(q);
b=e.getImage(b);b.setZIndex(a);b.linkedInfo=f;this.layers[a]=b}else console.log("undefined")};var w=function(a,b){return{x:l*(a.x-b.left)/(b.right-b.left),y:d*(a.y-b.top)/(b.bottom-b.top)}},C,v;this.setBBOX=function(a,b){if(C!==b+""||v!==a+"")C=b+"",v=a+"",!1===f.hidden&&f.display(a,b)};this.setOpacity=function(a,b){a>=this.layers.length?error("setOpacity :invalid id"):(b=parseFloat(b),this.layers[a].getOpacity()!==b&&this.layers[a].setOpacity(b))};this.getBuffer=function(){return f.canvas}};function WMJSTimeSelector(a,b,e){var g=function(){this.values=[]};g.prototype.add=function(a){if(!0===this[a])return!1;this[a]=!0;this.values.push(a);return!0};var c=this;this.element=a;this.webmapjs=void 0;this.values=[];var f=24;isDefined(e)&&(f=e);var m=$('<div class="WMJSTimeSelector-controlElement WMJSTimeSelector-noselect"/>',{}),l=$('<div class="WMJSTimeSelector-timeChooserElement WMJSTimeSelector-noselect"/>',{}),d=$('<div class="WMJSTimeSelector-timeinfo WMJSTimeSelector-noselect"/>',{}),
n=$('<div class=""WMJSTimeSelector-controlElementBottom WMJSTimeSelector-noselect"/>',{});this.element.append(d);this.element.append(m);this.element.append(l);this.element.append(n);a=$("<button>&lt;&lt;</button>").button().click(function(){var a=c.makeDateList(c.webmapjs,c.currentValue,f);t(a[0])});e=$("<button>&gt;&gt;</button>").button().click(function(){var a=c.makeDateList(c.webmapjs,c.currentValue,f);t(a[a.length-1])});var q=$("<button>&lt;</button>").button().click(function(){for(var a=c.makeDateList(c.webmapjs,
c.currentValue,f),b=1;b<a.length;b++)if(a[b]==c.currentValue){t(a[b-1]);return}t(a[0])}),w=$("<button>&gt;</button>").button().click(function(){for(var a=c.makeDateList(c.webmapjs,c.currentValue,f),b=0;b<a.length-1;b++)if(a[b]==c.currentValue){t(a[b+1]);return}t(a[a.length-1])});m.append("<table class='WMJSTimeSelector-table'><tr><th>"+I18n.year.text+"</th><th>"+I18n.month.text+"</th><th>"+I18n.day.text+"</th><th>"+I18n.hour.text+"</th><th>"+I18n.min.text+"</th></tr><tr><td><input class='WMJSTimeSelector_yearspinner'/></td><td><input class='WMJSTimeSelector_monthspinner'/></td><td><input class='WMJSTimeSelector_dayspinner'/></td><td><input class='WMJSTimeSelector_hourspinner'/></td><td><input class='WMJSTimeSelector_minutespinner'/></td></tr>");
var C=$("<button>"+I18n.load_all.text+"</button>").button().click(function(){for(var a=c.values,b=0;b<a.length;b++)W(a[b])}),v=$("<button>"+I18n.play_animation.text+"</button>").button().click(function(){for(var a=c.values,b=[],d=0;d<a.length;d++)W(a[d]),b.push({name:"time",value:a[d]});c.webmapjs.draw(b)}),z=$("<button>"+I18n.stop.text+"</button>").button().click(function(){c.webmapjs.stopAnimating()});n.append(C);n.append(v);n.append(z);var r=m.find(".WMJSTimeSelector_yearspinner"),I=m.find(".WMJSTimeSelector_monthspinner"),
D=m.find(".WMJSTimeSelector_dayspinner"),R=m.find(".WMJSTimeSelector_hourspinner"),k=m.find(".WMJSTimeSelector_minutespinner"),M=m.find(".WMJSTimeSelector_secondspinner"),n=$('<div class="WMJSTimeSelector_timebuttons"/>',{});n.append(a);n.append(q);n.append(w);n.append(e);m.append(n);var J="",E=function(a,b){for(a=""+a;a.length<b;)a="0"+a;return a},u=function(a,b){var d=J;"year"==a&&(d=[E(b,4),d.slice(4)].join(""));"month"==a&&(d=[d.slice(0,5),E(b,2),d.slice(7)].join(""));"day"==a&&(d=[d.slice(0,
8),E(b,2),d.slice(10)].join(""));"hour"==a&&(d=[d.slice(0,11),E(b,2),d.slice(13)].join(""));"minute"==a&&(d=[d.slice(0,14),E(b,2),d.slice(16)].join(""));"second"==a&&(d=[d.slice(0,17),E(b,2),d.slice(19)].join(""));a=parseISO8601DateToDate(d);d=a.toISO8601();if(d!=c.currentValue&&(b=c.makeDateList(c.webmapjs,d,3),b[1]==c.currentValue)){var e=parseISO8601DateToDate(b[1]);a>e?d=b[2]:a<e&&(d=b[0])}d!=J&&(ca(d),t(d));return!1},ca=function(a){isDefined(a)&&(J=a,r.spinner("value",a.substring(0,4)),I.spinner("value",
a.substring(5,7)),D.spinner("value",a.substring(8,10)),R.spinner("value",a.substring(11,13)),k.spinner("value",a.substring(14,16)),M.spinner("value",a.substring(17,19)))};r.spinner({spin:function(a,b){return u("year",b.value)},change:function(a,b){u("year",$(a.target).spinner("value"))},numberFormat:"d4"});I.spinner({spin:function(a,b){return u("month",b.value)},change:function(a,b){u("month",$(a.target).spinner("value"))},numberFormat:"d2"});D.spinner({spin:function(a,b){return u("day",b.value)},
change:function(a,b){u("day",$(a.target).spinner("value"))},numberFormat:"d2"});R.spinner({spin:function(a,b){return u("hour",b.value)},change:function(a,b){u("hour",$(a.target).spinner("value"))},numberFormat:"d2"});k.spinner({spin:function(a,b){return u("minute",b.value)},change:function(a,b){u("minute",$(a.target).spinner("value"))},numberFormat:"d2"});M.spinner({spin:function(a,b){return u("second",b.value)},change:function(a,b){u("second",$(a.target).spinner("value"))},numberFormat:"d2"});r.spinner().keyup(function(a,
b){13==(a.keyCode||a.which)&&u("year",$(event.target).spinner("value"))});I.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("month",$(event.target).spinner("value"))});D.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("day",$(event.target).spinner("value"))});R.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("hour",$(event.target).spinner("value"))});k.spinner().keyup(function(a,b){13==(a.keyCode||a.which)&&u("minute",$(event.target).spinner("value"))});M.spinner().keyup(function(a,
b){13==(a.keyCode||a.which)&&u("second",$(event.target).spinner("value"))});this.loadingComplete=function(a){this.generate(a,!1,!0)};this.dimensionUpdate=function(a){this.generate(a,!0,!0)};this.dimensionChange=function(a){this.generate(a,!1,!1)};var ja=function(a){ca(a);a=parseISO8601DateToDate(a);$(d).html(I18n.local_time.text+":<br/><b>"+a.toString().replace(/GMT.*/g,"")+"</b>")},t=function(a){c.webmapjs.stopAnimating();ja(a);b(a)};this.makeDateList=function(a,b,c){var d=[];a=a.getLayers();for(var e=
0;e<a.length;e++)if(1==a[e].enabled){var f=a[e].getDimension("time");f&&d.push(f)}f=new g;for(e=0;e<c;e++)for(var k=0;k<d.length;k++){var l=d[k];a=l.getIndexForValue(b,!1);var m=e+a;0>m&&(m=0);m>l.size()-1&&(m=l.size()-1);0<=m&&m<l.size()&&f.add(l.getValueForIndex(m));m=-e+a;0>m&&(m=0);m>l.size()-1&&(m=l.size()-1);0<=m&&m<l.size()&&f.add(l.getValueForIndex(m))}f.values.sort();for(e=d=0;e<f.values.length;e++)if(b==f.values[e]){d=e;break}k=0;b=new g;for(e=0;e<c;e++){a=d+e;if(0<a&&a<f.values.length&&
1==b.add(f.values[a])&&(k++,k>c))break;a=d-e;if(0<a&&a<f.values.length&&1==b.add(f.values[a])&&(k++,k>c))break}b.values.sort();c=[];for(e=0;e<b.values.length;e++)c.push(b.values[e]);return c};var A=function(a){if(!c.webmapjs)return!1;var b=c.webmapjs.getDimension("time");if(!isDefined(b))return!1;b=b.currentValue;c.webmapjs.suspendEvent("ondimchange");c.webmapjs.suspendEvent("ondimupdate");c.webmapjs.setDimension("time",a);a=function(){var a=c.webmapjs.getWMSRequests();if(0==a.length)return!1;for(var b=
0;b<a.length;b++)if(0==c.webmapjs.isThisRequestLoaded(a[b]))return!1;return!0}();c.webmapjs.setDimension("time",b);c.webmapjs.resumeEvent("ondimchange");c.webmapjs.resumeEvent("ondimupdate");return a},W=function(a){if(!c.webmapjs)return!1;var b=c.webmapjs.getDimension("time");if(!isDefined(b))return!1;b=b.currentValue;c.webmapjs.suspendEvent("ondimchange");c.webmapjs.suspendEvent("ondimupdate");c.webmapjs.setDimension("time",a);a=[];var d=c.webmapjs.getWMSRequests();if(0==d.length)a=!1;else for(var e=
0;e<d.length;e++)0==c.webmapjs.isThisRequestLoaded(d[e])&&a.push(d[e]);c.webmapjs.prefetch(a);c.webmapjs.setDimension("time",b);c.webmapjs.resumeEvent("ondimchange");c.webmapjs.resumeEvent("ondimupdate");return a};this.generate=function(a,b,e){this.webmapjs=a;if(a.getDimension("time")){m.show();d.show();var g=a.getDimension("time").currentValue;if("current"==g)for(var k=a.getLayers(),n=0;n<k.length;n++){var q=k[n].getDimension("time");q&&(g=q.getValueForIndex(q.getIndexForValue(g,!1)))}c.currentValue=
g;ja(c.currentValue);if(0==b){k=!1;if(isDefined(c.values))for($(c.element).find(".WMJSTimeSelector-tr").removeClass("WMJSTimeSelector-col-selected"),n=0;n<c.values.length;n++)b=!1,q=$(c.element).find(".WMJSTimeSelector-tr:eq("+n+")"),!0===e&&(b=!1,q.hasClass("WMJSTimeSelector-col-loaded")&&(b=!0),b||(b=1==A(c.values[n])),b?q.addClass("WMJSTimeSelector-col-loaded"):q.removeClass("WMJSTimeSelector-col-loaded")),c.currentValue==c.values[n]&&(c.currentValue=g,q.addClass("WMJSTimeSelector-col-selected"),
k=!0);if(1==k)return}c.values=c.makeDateList(a,g,f);a="<table class='WMJSTimeSelector-table WMJSTimeSelector-noselect'>";e=function(a){var b="WMJSTimeSelector-tr";1==a.isLoaded&&(b+=" WMJSTimeSelector-col-loaded");a.value==g&&(b+=" WMJSTimeSelector-col-selected");return"<tr class='"+b+"'>"+("<td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.textdate+"</td><td class='WMJSTimeSelector-colindex'>"+a.index+"</td><td class='WMJSTimeSelector-col'>"+a.texttime+"</td>")+
"</tr>"};b={};for(n=0;n<c.values.length;n++)b.index=n,b.value=c.values[n],b.text=b.value.replace(/T/g," | "),b.text=b.text.replace(/Z/g," "),b.textdate=b.value.split("T")[0],b.texttime=b.value.split("T")[1],b.texttime=b.texttime.split(":")[0]+":"+b.texttime.split(":")[1]+"z",b.isLoaded=A(b.value),a+=e(b);n=""+(a+"</table>");$(l).html(n);var r=function(a){a=$(a.target).parent().find("td").first().html();t(c.values[a])};$(c.element).find(".WMJSTimeSelector-tr").mouseover(function(a){0!=da&&r(a)});$(c.element).find(".WMJSTimeSelector-tr").mousedown(r)}else $(l).html(I18n.no_dimensions_available.text),
m.hide(),d.hide(),c.currentValue="",c.values=[]};var da=!1;$(document).mousedown(function(){da=!0}).mouseup(function(){da=!1});$(c.element).bind("mousewheel",function(a){var b=0;try{isDefined(a.originalEvent.deltaY)&&(b=a.originalEvent.deltaY)}catch(F){}0==b&&(b=0<a.originalEvent.wheelDelta/120?-1:1);0>b?q.click():w.click()})};var GFITimeElevationWindow=function(a){this.t=function(){return 123};this.setSize=function(b,c){b-=80;c-=70;a.width(b);a.height(c);var f=a.find(".timeaxis").get(0).getContext("2d");f.canvas.height=50;f.canvas.width=b;f=a.find(".heightaxis").get(0).getContext("2d");f.canvas.height=c;f.canvas.width=60;e.setSize(b,c);e.draw()};a.html('<table class="gfi_table"><tr class="gfi_table_tr"><td class="gfi_table_td"><canvas class="heightaxis" class="gfi_nomarginpadding"  ></canvas></td><td class="gfi_table_td"><div class="gfi_nomarginpadding gfi_mainmap" style="width:1200px;height:600px;"></div></td><td><div class="legend"></div></td></tr><tr class="gfi_table_tr"><td class="gfi_table_td"></td><td><canvas class="timeaxis"  class="gfi_nomarginpadding"   ></canvas><td class="gfi_table_td"></td></tr></table>');
var b=a.find(".gfi_mainmap").get(0);var e=new WMJSMap(b);e.hideScaleBar();e.displayLegendInMap(!1);e.getOverlayElement().css("border","1px solid black");this.setSize(a.width(),a.height());this.updateBBOX=function(b){var c=a.find(".timeaxis").get(0).getContext("2d");c.fillStyle="#FFF";c.font="10px Arial";c.fillRect(0,0,e.getWidth(),50);var f=-1;for(var g=Math.round(b.left);g<Math.round(b.right);g+=1E4){var l=new Date(g);-1==f&&(f=l.getUTCHours());if(f!=l.getUTCHours()){c.fillStyle="#000000";var d=
(g-b.left)/(b.right-b.left)*e.getWidth();c.beginPath();c.moveTo(d-1,0);c.lineTo(d-1,10);c.stroke();f=l.getUTCHours();c.fillText(f,d-c.measureText(f).width/2-1,20);f=l.getUTCHours()}}c.font="14px Arial";c.fillText("time UTC (h)",e.getWidth()/2-100,38);c=a.find(".heightaxis").get(0).getContext("2d");c.font="10px Arial";c.fillStyle="#FFF";c.fillRect(0,0,60,e.getHeight());c.textAlign="right";f=-1.1;if(!(100<Math.abs(Math.round(b.top)-Math.round(b.bottom))/1E3)){for(g=Math.round(b.bottom);g<Math.round(b.top);g+=
1)l=Math.floor(g/1E3),-1.1==f&&(f=l),f!=l&&(c.fillStyle="#000000",d=(g-b.top)/(b.bottom-b.top)*e.getHeight(),c.beginPath(),c.moveTo(50,d),c.lineTo(60,d),c.stroke(),f=g,c.fillText(f,48,d+3),f=l);c.save();c.translate(5,e.getHeight()/2-50);c.rotate(-Math.PI/2);c.font="14px Arial";c.fillText("height (m)",5,6);c.restore()}};this.drawLegend=function(){var b=e.getLayers()[0],b=e.getLegendGraphicURLForLayer(b);a.find(".legend").html('<img class="legendimg" src="'+b+'&TRANSPARENT=TRUE"/>')};e.addListener("onupdatebbox",
this.updateBBOX,!0);e.setProjection("GFI:TIME_ELEVATION",[(new Date("2016-04-01T00:00:00Z")).getTime(),0,(new Date("2016-04-02T00:00:00Z")).getTime(),15270]);this.updateBBOX(e.getProjection().bbox);this.getWebMapJS=function(){return e}};var WMJSAnimate=function(a){a.animationDelay=100;var b=a.getListener(),e=a.getImageStore(),g=this,c=document.createElement("div");$(c).mouseout(function(){a.mouseHoverAnimationBox=!1});var f=0,m=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else if(a.animationTimer.init(50,m),g.checkAnimation(),f--,!(0<f)){var c=a.animationDelay;0==a.currentAnimationStep&&(c*=3);a.currentAnimationStep==a.animationList.length-1&&(c*=5);f=c/50;if(!1===a.mouseHoverAnimationBox){0!=a.isAnimating&&1!=a.animateBusy&&
((c=a.animationList[a.currentAnimationStep])?(a.setDimension(c.name,c.value,!1),b.triggerEvent("ondimchange"),b.triggerEvent("onnextanimationstep",a),a._pdraw(),a.animateBusy=!1):error("No animation step for "+a.currentAnimationStep));c=a.currentAnimationStep+1;c>=a.animationList.length&&(c=0);var d=!1,e=0,q=a.animationList[c];a.setDimension(q.name,q.value,!1);a.animationList[c].requests=a.getWMSRequests();q=a.animationList[a.currentAnimationStep];a.setDimension(q.name,q.value,!1);for(q=0;q<a.animationList[c].requests.length;q++){var w=
a.animationList[c].requests[q];(w=a.getImageStore().getImageForSrc(w))&&w.isLoaded()?e++:f=0}e==a.animationList[c].requests.length&&(d=!0);d&&(a.currentAnimationStep=c)}}};a.isAnimatingLoopRunning=!1;g.checkAnimation=function(){if(0==a.isAnimating)a.isAnimatingLoopRunning=!1;else{a.animationTimer||(a.animationTimer=new WMJSTimer);if(!1===a.mouseHoverAnimationBox){var b=e.getNumImagesLoading();if(8>b&&0<a.animationList.length)for(var c=0;6>c;c++){for(var f=c+a.currentAnimationStep;0>f;)f+=a.animationList.length;
for(;f>=a.animationList.length;)f-=a.animationList.length;0>f&&(f=0);if(0<=f){var g=a.animationList[f];a.setDimension(g.name,g.value,!1);a.animationList[f].requests=a.getWMSRequests();g=a.animationList[a.currentAnimationStep];a.setDimension(g.name,g.value,!1);a.animationList[f].imagesInPrefetch=a.prefetch(a.animationList[f].requests);b+=a.animationList[f].imagesInPrefetch.length;if(7<b)break}}}0==a.isAnimatingLoopRunning&&(a.isAnimatingLoopRunning=!0,m())}};a.stopAnimating=function(){0!=a.isAnimating&&
(c.style.display="none",a.isAnimating=!1,a.animateBusy=!1,a.rebuildMapDimensions(),b.triggerEvent("onstopanimation",a))};a.currentAnimationStep=0;a.animationList=void 0;a.isAnimating=!1;a.setAnimationDelay=function(b){1>b&&(b=1);a.animationDelay=b};c.style.zIndex=1E4;c.style.background="none";c.style.position="absolute";c.style.border="none";c.style.margin="0px";c.style.padding="0px";c.style.lineHeight="14px";c.style.fontFamily='"Courier New", "Lucida Console", Monospace';c.style.fontSize="10px";
a.getBaseElement().append(c)};var WMJSDialog={},WMJSDialogsCreated=0;WMJSDialog.closeAllDialogs=function(a){for(var b=0;b<a.length;b++)a[b].remove()};
WMJSDialog.createDialog=function(a,b,e){WMJSDialogsCreated++;var g=0,c=0,f=!0,m=!0;isDefined(a.id);isDefined(a.show)&&(f=a.show);isDefined(a.x)&&(g=a.x);isDefined(a.y)&&(c=a.y);isDefined(a.autoDestroy)&&(m=a.autoDestroy);var l=jQuery("<div />",{css:{minHeight:"20px",height:180,width:320,zIndex:1E3,border:"1px solid #01405e",borderRadius:"3px",position:"absolute",boxShadow:"0.06rem 0.125rem 0.125rem rgba(0, 0, 0, 0.3)",margin:0,padding:"0px",backgroundColor:"#01547d",display:"inline-block"},mousedown:function(a){a.stopPropagation();
preventdefault_event(a)},mousewheel:function(a){a.stopPropagation()}});f&&l.appendTo(b);l.hasBeenDragged=!1;l.on("drag",function(a,b){l.hasBeenDragged=!0});l.resizable();l.draggable();l.closeDialog=function(){0==m?(l.hide(),l.trigger("hide")):(l.remove(),dialogClosed(l))};l.keyup(function(a){27==a.keyCode&&l.closeDialog()});jQuery("<div/>",{css:{color:"white",fontWeight:"bold",textColor:"white",width:"16px",height:"16px",lineHeight:"14px",margin:"1px",padding:"1px !important",zIndex:1200},click:function(){l.closeDialog()}}).appendTo(l).iconbutton({label:"X"}).addClass("wmjsdialog-closebutton");
var d=jQuery("<div/>",{css:{position:"absolute",right:"0px",top:"18px",background:"#FFF",borderTop:"1px solid #01405e",width:"100%",height:"100%",overflow:"auto",fontSize:"10px",lineHeight:"12px"},mousedown:function(a){a.stopPropagation();preventdefault_event(a)}}).appendTo(l);l.resize(function(){d.css({width:l.width()+"px",height:l.height()-18+"px"})});l.resize();l.setLoading=function(){d.html('<img style="margin-left:10px;margin-top:10px;" src="'+loadingImageSrc+'"/>')};l.setXY=function(a,b){l.hasBeenDragged=
!1;l.css({left:a+"px",top:b+"px"});var c=e.getGeoCoordFromPixelCoord({x:a,y:b});l.geoPosX=c.x;l.geoPosY=c.y;l.x=a;l.y=b};l.setXY(g,c);l.origX=g;l.origY=c;l.setLoading();l.setHTML=function(a){d.html(a)};isDefined(a.dataURL)&&(b=function(a){d.html(a)},MakeHTTPRequest(a.dataURL,b,b));return l};
